<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BitsDraw</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
</head>
<body>
    <!-- Menu Bar -->
    <div class="menu-bar">
        <div class="menu-item" data-menu="file">File</div>
        <div class="menu-item" data-menu="edit">Edit</div>
        <div class="menu-item" data-menu="effects">Effects</div>
        <div class="menu-item" data-menu="view">View</div>
        <div class="menu-item" data-menu="window">Window</div>
        <div class="menu-item" data-menu="help">Help</div>
    </div>

    <!-- Menus -->

    <div class="menu-dropdown" id="menu-file">
        <div class="menu-dropdown-item" data-action="new">
            <span>New</span>
            <span class="menu-shortcut">⌃N</span>
        </div>
        <div class="menu-dropdown-item" data-action="open">
            <span>Open...</span>
            <span class="menu-shortcut">⌃O</span>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-dropdown-item" data-action="save">
            <span>Save</span>
            <span class="menu-shortcut">⌃S</span>
        </div>
        <div class="menu-dropdown-item" data-action="save-as">Save As...</div>
        <div class="menu-divider"></div>
        <div class="menu-dropdown-item" data-action="import-image">Import Image...</div>
        <div class="menu-dropdown-item has-submenu" data-action="export">
            <span>Export</span>
            <span class="menu-arrow">▶</span>
        </div>
        <div class="menu-submenu" id="submenu-export">
            <div class="menu-dropdown-item" data-action="export-cpp">
                <span>CPP header file (u8g2)</span>
                <span class="menu-shortcut">⌃E</span>
            </div>
            <div class="menu-dropdown-item" data-action="export-png">PNG</div>
        </div>
    </div>

    <div class="menu-dropdown" id="menu-edit">
        <div class="menu-dropdown-item" data-action="undo">
            <span>Undo</span>
            <span class="menu-shortcut">⌃Z</span>
        </div>
        <div class="menu-dropdown-item" data-action="redo">
            <span>Redo</span>
            <span class="menu-shortcut">⌃Y</span>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-dropdown-item" data-action="cut">
            <span>Cut</span>
            <span class="menu-shortcut">⌃X</span>
        </div>
        <div class="menu-dropdown-item" data-action="copy">
            <span>Copy</span>
            <span class="menu-shortcut">⌃C</span>
        </div>
        <div class="menu-dropdown-item" data-action="paste">
            <span>Paste</span>
            <span class="menu-shortcut">⌃V</span>
        </div>
        <div class="menu-dropdown-item" data-action="select-all">
            <span>Select All</span>
            <span class="menu-shortcut">⌃A</span>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-dropdown-item" data-action="rescale">Rescale Canvas...</div>
        <div class="menu-dropdown-item" data-action="clear-selection">
            <span>Clear Selection</span>
            <span class="menu-shortcut">Delete</span>
        </div>
    </div>

    <div class="menu-dropdown" id="menu-effects">
        <div class="menu-dropdown-item" data-action="invert-bitmap">
            <span>Invert</span>
        </div>
    </div>

    <div class="menu-dropdown" id="menu-view">
        <div class="menu-dropdown-item" data-action="zoom-in">
            <span>Zoom In</span>
            <span class="menu-shortcut">⌃=</span>
        </div>
        <div class="menu-dropdown-item" data-action="zoom-out">
            <span>Zoom Out</span>
            <span class="menu-shortcut">⌃-</span>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-dropdown-item" data-action="show-grid">
            <span>Show Grid</span>
            <span class="menu-shortcut">⌃G</span>
        </div>
        <div class="menu-dropdown-item" data-action="invert">
            <span>Invert Display</span>
            <span class="menu-shortcut">⌃I</span>
        </div>
    </div>

    <div class="menu-dropdown" id="menu-window">
        <div class="menu-dropdown-item" data-action="show-tools">Tools</div>
        <div class="menu-dropdown-item" data-action="show-colors">Patterns</div>
        <div class="menu-dropdown-item" data-action="show-options">Options</div>
        <div class="menu-dropdown-item" data-action="show-layers">Layers</div>
        <div class="menu-dropdown-item" data-action="show-preview">Preview</div>
        <div class="menu-dropdown-item" data-action="show-code">Generated Code</div>
    </div>

    <div class="menu-dropdown" id="menu-help">
        <div class="menu-dropdown-item" data-action="about">About BitsDraw...</div>
        <div class="menu-divider"></div>
        <div class="menu-dropdown-item" data-action="shortcuts">Keyboard Shortcuts</div>
    </div>

    <div class="desktop">
        <!-- Canvas Window -->
        <div class="window" id="canvas-window" style="left: 300px; top: 50px; width: 600px; height: 500px;">
            <div class="window-title-bar">
                <div class="window-controls">
                    <div class="window-control close"><i class="ph ph-x"></i></div>
                    <div class="window-control minimize"><i class="ph ph-minus"></i></div>
                    <div class="window-control zoom"><i class="ph ph-square"></i></div>
                </div>
                <div class="window-title">Canvas - my_bitmap (128x64)</div>
            </div>
            <div class="window-content">
                <div class="canvas-area">
                    <canvas id="bitmap-canvas"></canvas>
                </div>
                <div class="canvas-controls">
                    <div class="control-group">
                        <label>
                            Zoom:
                            <select id="zoom-select">
                                <option value="1">1x</option>
                                <option value="2">2x</option>
                                <option value="4" selected>4x</option>
                                <option value="8">8x</option>
                                <option value="16">16x</option>
                                <option value="32">32x</option>
                            </select>
                        </label>
                        <button id="zoom-out-btn" title="Zoom Out"><i class="ph ph-magnifying-glass-minus"></i></button>
                        <button id="zoom-in-btn" title="Zoom In"><i class="ph ph-magnifying-glass-plus"></i></button>
                    </div>
                    <div class="control-group">
                        <button id="invert-display-btn" title="Invert Display"><i class="ph ph-subtract-square"></i></button>
                        <button id="show-grid-btn" title="Show Grid" class="active"><i class="ph ph-grid-four"></i></button>
                    </div>
                </div>
            </div>
            <div class="window-resize-handle"></div>
        </div>

        <!-- Tools Window -->
        <div class="window" id="tools-window" style="left: 20px; top: 50px; width: 200px; height: auto;">
            <div class="window-title-bar">
                <div class="window-controls">
                    <div class="window-control close"><i class="ph ph-x"></i></div>
                    <div class="window-control minimize"><i class="ph ph-minus"></i></div>
                </div>
                <div class="window-title">Tools</div>
            </div>
            <div class="window-content">
                <div class="tool-palette">
                    <div class="tool-row">
                        <button id="pencil-tool" class="tool-icon active" title="Pencil"><i class="ph ph-pencil-simple"></i></button>
                        <button id="brush-tool" class="tool-icon" title="Brush"><i class="ph ph-paint-brush"></i></button>
                    </div>
                    <div class="tool-row">
                        <button id="bucket-tool" class="tool-icon" title="Bucket Fill"><i class="ph ph-paint-bucket"></i></button>
                        <button id="eraser-tool" class="tool-icon" title="Eraser"><i class="ph ph-eraser"></i></button>
                    </div>
                    <div class="tool-row">
                        <button id="select-rect-tool" class="tool-icon" title="Rectangle Select"><i class="ph ph-selection"></i></button>
                        <button id="select-circle-tool" class="tool-icon" title="Circle Select"><i class="ph ph-circle-dashed"></i></button>
                    </div>
                    <div class="tool-row">
                        <button id="line-tool" class="tool-icon" title="Line"><i class="ph ph-line-segment"></i></button>
                        <button id="text-tool" class="tool-icon" title="Text"><i class="ph ph-text-aa"></i></button>
                    </div>
                    <div class="tool-row">
                        <button id="rect-tool" class="tool-icon" title="Rectangle"><i class="ph ph-rectangle"></i></button>
                        <button id="circle-tool" class="tool-icon" title="Circle"><i class="ph ph-circle"></i></button>
                    </div>
                    <div class="tool-row">
                        <button id="spray-tool" class="tool-icon" title="Spray"><i class="ph ph-spray-bottle"></i></button>
                        <button id="eyedropper-tool" class="tool-icon" title="Eyedropper"><i class="ph ph-eyedropper"></i></button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Patterns Window -->
        <div class="window" id="colors-window" style="left: 20px; top: 250px; width: 180px; height: auto;">
            <div class="window-title-bar">
                <div class="window-controls">
                    <div class="window-control close"><i class="ph ph-x"></i></div>
                    <div class="window-control minimize"><i class="ph ph-minus"></i></div>
                </div>
                <div class="window-title">Patterns</div>
            </div>
            <div class="window-content">
                <div class="color-palette">
                    <div class="color-swatch selected" data-pattern="solid-black" style="background: #000000;" title="Black"></div>
                    <div class="color-swatch" data-pattern="solid-white" style="background: #ffffff; border: 1px solid #808080;" title="White"></div>
                    <div class="color-swatch" data-pattern="dither-50" title="50% Dither"></div>
                    <div class="color-swatch" data-pattern="dither-25" title="25% Dither"></div>
                    <div class="color-swatch" data-pattern="dither-75" title="75% Dither"></div>
                    <div class="color-swatch" data-pattern="lines-horizontal" title="Horizontal Lines"></div>
                    <div class="color-swatch" data-pattern="lines-vertical" title="Vertical Lines"></div>
                    <div class="color-swatch" data-pattern="cross-hatch" title="Cross Hatch"></div>
                    <div class="color-swatch" data-pattern="dots" title="Dots"></div>
                    <div class="color-swatch" data-pattern="diagonal" title="Diagonal"></div>
                </div>
            </div>
        </div>

        <!-- Options Window -->
        <div class="window" id="options-window" style="left: 20px; top: 380px; width: 600px; height: 60px;">
            <div class="window-title-bar">
                <div class="window-controls">
                    <div class="window-control close"><i class="ph ph-x"></i></div>
                    <div class="window-control minimize"><i class="ph ph-minus"></i></div>
                </div>
                <div class="window-title">Tool Options</div>
            </div>
            <div class="window-content">
                <div class="tool-options" id="tool-options">
                    <!-- Pencil/Brush options -->
                    <div class="option-section" id="pencil-options" style="display: none;">
                        <label>Size: <input type="range" id="brush-size" min="1" max="10" value="1"> <span id="brush-size-value">1</span>px</label>
                        <label><input type="checkbox" id="smooth-drawing"> Smooth</label>
                    </div>
                    
                    <!-- Shape tools options -->
                    <div class="option-section" id="shape-options" style="display: none;">
                        <label><input type="checkbox" id="draw-border" checked> <i class="ph ph-square"></i> Border</label>
                        <label><input type="checkbox" id="draw-fill"> <i class="ph ph-square-fill"></i> Fill</label>
                    </div>
                    
                    <!-- Spray options -->
                    <div class="option-section" id="spray-options" style="display: none;">
                        <label>Size: <input type="range" id="spray-radius" min="2" max="15" value="5"> <span id="spray-radius-value">5</span>px</label>
                        <label>Density: <input type="range" id="spray-density" min="10" max="100" value="30"> <span id="spray-density-value">30</span>%</label>
                    </div>
                    
                    <!-- Selection options -->
                    <div class="option-section" id="selection-options" style="display: none;">
                        <button id="clear-selection-btn"><i class="ph ph-selection"></i> Clear Selection</button>
                        <button id="select-all-btn"><i class="ph ph-selection-all"></i> Select All</button>
                    </div>
                    
                    <!-- Text options -->
                    <div class="option-section" id="text-options" style="display: none;">
                        <span class="option-label">Click on canvas to add text</span>
                    </div>
                    
                    <!-- Bucket fill options -->
                    <div class="option-section" id="bucket-options" style="display: none;">
                        <label><input type="checkbox" id="fill-contiguous" checked> Contiguous</label>
                    </div>
                    
                    <!-- No options for other tools -->
                    <div class="option-section" id="no-options" style="display: block;">
                        <span class="option-label">Select a tool to view options</span>
                    </div>
                </div>
            </div>
        </div>


        <!-- Generated Code Window -->
        <div class="window" id="code-window" style="left: 920px; top: 50px; width: 400px; height: 600px;">
            <div class="window-title-bar">
                <div class="window-controls">
                    <div class="window-control close"><i class="ph ph-x"></i></div>
                    <div class="window-control minimize"><i class="ph ph-minus"></i></div>
                    <div class="window-control zoom"><i class="ph ph-square"></i></div>
                </div>
                <div class="window-title">Generated Code</div>
            </div>
            <div class="window-content">
                <div class="option-group">
                    <label>
                        Project Name: <input type="text" id="project-name" value="my_bitmap">
                    </label>
                    <button id="export-btn">Copy .h Code</button>
                </div>
                <div class="option-group">
                    <h4>Data</h4>
                    <button id="save-btn">Save to Browser</button>
                    <button id="load-btn">Load from Browser</button>
                </div>
                <div class="option-group">
                    <h4>Import Code</h4>
                    <textarea id="import-code" placeholder="Paste .h code here..." rows="3" style="width: 100%; font-family: monospace; font-size: 10px;"></textarea>
                    <button id="import-btn">Import .h Code</button>
                </div>
                <div class="output-area">
                    <textarea id="output-code" readonly placeholder="Generated C code will appear here..."></textarea>
                </div>
            </div>
        </div>

        <!-- About BitsDraw Window -->
        <div class="window hidden" id="about-window" style="left: 400px; top: 200px; width: 450px; height: 350px;">
            <div class="window-title-bar">
                <div class="window-controls">
                    <div class="window-control close"><i class="ph ph-x"></i></div>
                </div>
                <div class="window-title">About BitsDraw</div>
            </div>
            <div class="window-content">
                <div class="about-content">
                    <div class="about-icon">
                        <img src="icons/BitsDraw.png" alt="BitsDraw" class="app-icon-image">
                    </div>
                    <div class="about-info">
                        <h2>BitsDraw</h2>
                        <p class="version">Version 1.0.0</p>
                        <p class="description">A bitmap editor for monochrome displays</p>
                        
                        <div class="about-section">
                            <h3>Features</h3>
                            <ul>
                                <li>Pixel-perfect bitmap editing</li>
                                <li>Multiple drawing tools and patterns</li>
                                <li>Multiple format export</li>
                                <li>Image import and processing</li>
                                <li>Undo/Redo functionality</li>
                                <li>Multi-window interface</li>
                            </ul>
                        </div>
                        
                        <div class="about-section">
                            <h3>Built with</h3>
                            <p>HTML5 Canvas, JavaScript, CSS3</p>
                        </div>
                        
                        <div class="about-section">
                            <h3>Copyright</h3>
                            <p>© 2024 kurogedelic. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Keyboard Shortcuts Window -->
        <div class="window hidden" id="shortcuts-window" style="left: 450px; top: 150px; width: 400px; height: 450px;">
            <div class="window-title-bar">
                <div class="window-controls">
                    <div class="window-control close"><i class="ph ph-x"></i></div>
                </div>
                <div class="window-title">Keyboard Shortcuts</div>
            </div>
            <div class="window-content">
                <div class="shortcuts-content">
                    <div class="shortcuts-section">
                        <h3>File Operations</h3>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃N</span>
                            <span class="shortcut-desc">New Canvas</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃S</span>
                            <span class="shortcut-desc">Save</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃O</span>
                            <span class="shortcut-desc">Open</span>
                        </div>
                    </div>
                    
                    <div class="shortcuts-section">
                        <h3>Edit Operations</h3>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃Z</span>
                            <span class="shortcut-desc">Undo</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃Y</span>
                            <span class="shortcut-desc">Redo</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃A</span>
                            <span class="shortcut-desc">Select All</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃C</span>
                            <span class="shortcut-desc">Copy Selection</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃X</span>
                            <span class="shortcut-desc">Cut Selection</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃V</span>
                            <span class="shortcut-desc">Paste Selection</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">Delete</span>
                            <span class="shortcut-desc">Delete Selection</span>
                        </div>
                    </div>
                    
                    <div class="shortcuts-section">
                        <h3>Tools</h3>
                        <div class="shortcut-item">
                            <span class="shortcut-key">P</span>
                            <span class="shortcut-desc">Pencil Tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">B</span>
                            <span class="shortcut-desc">Brush Tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">F</span>
                            <span class="shortcut-desc">Bucket Fill</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">E</span>
                            <span class="shortcut-desc">Eraser Tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">L</span>
                            <span class="shortcut-desc">Line Tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">T</span>
                            <span class="shortcut-desc">Text Tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">R</span>
                            <span class="shortcut-desc">Rectangle Tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">C</span>
                            <span class="shortcut-desc">Circle Tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">S</span>
                            <span class="shortcut-desc">Spray Tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">I</span>
                            <span class="shortcut-desc">Eyedropper Tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">M</span>
                            <span class="shortcut-desc">Select Tool</span>
                        </div>
                    </div>
                    
                    <div class="shortcuts-section">
                        <h3>View</h3>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃=</span>
                            <span class="shortcut-desc">Zoom In</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃-</span>
                            <span class="shortcut-desc">Zoom Out</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃G</span>
                            <span class="shortcut-desc">Toggle Grid</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃I</span>
                            <span class="shortcut-desc">Invert Display</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Layers Window -->
        <div class="window" id="layers-window" style="left: 240px; top: 250px; width: 220px; height: 300px;">
            <div class="window-title-bar">
                <div class="window-controls">
                    <div class="window-control close"><i class="ph ph-x"></i></div>
                    <div class="window-control minimize"><i class="ph ph-minus"></i></div>
                </div>
                <div class="window-title">Layers</div>
            </div>
            <div class="window-content">
                <div class="layer-controls">
                    <button id="add-layer-btn" title="Add Layer"><i class="ph ph-plus"></i></button>
                    <button id="delete-layer-btn" title="Delete Layer"><i class="ph ph-trash"></i></button>
                    <button id="duplicate-layer-btn" title="Duplicate Layer"><i class="ph ph-copy"></i></button>
                </div>
                <div class="layer-list" id="layer-list">
                    <!-- Layers will be dynamically added here -->
                </div>
            </div>
        </div>

        <!-- Preview Window -->
        <div class="window" id="preview-window" style="left: 20px; top: 420px; width: 180px; height: 140px;">
            <div class="window-title-bar">
                <div class="window-controls">
                    <div class="window-control close"><i class="ph ph-x"></i></div>
                    <div class="window-control minimize"><i class="ph ph-minus"></i></div>
                </div>
                <div class="window-title">Preview (1:1)</div>
            </div>
            <div class="window-content">
                <div class="preview-area">
                    <canvas id="preview-canvas"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Text Input Balloon -->
    <div class="text-balloon" id="text-balloon" style="display: none;">
        <div class="balloon-content">
            <input type="text" id="text-input-balloon" placeholder="Enter text..." maxlength="50">
            <div class="balloon-buttons">
                <button id="add-text-balloon-btn"><i class="ph ph-check"></i></button>
                <button id="cancel-text-balloon-btn"><i class="ph ph-x"></i></button>
            </div>
        </div>
    </div>

    <!-- Brush Cursor Overlay -->
    <div class="brush-cursor-overlay" id="brush-cursor-overlay"></div>

    <script src="utils/optimizedBitmap.js"></script>
    <script src="utils/bitmap.js"></script>
    <script src="utils/export.js"></script>
    <script src="utils/imageImport.js"></script>
    <script src="utils/ditherPatterns.js"></script>
    <script src="utils/textRenderer.js"></script>
    <script src="utils/pngIconLoader.js"></script>
    <script src="main.js"></script>
</body>
</html>