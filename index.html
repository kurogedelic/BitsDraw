<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>BitsDraw</title>

		<!-- SEO Meta Tags -->
		<meta
			name="description"
			content="BitsDraw is a web-based bitmap editor specifically designed to generate U8G2-compatible bitmap data in .h file format. Create pixel art for OLED displays with real-time preview and multiple export formats."
		/>
		<meta
			name="keywords"
			content="bitmap editor, U8G2, OLED display, pixel art, Arduino, ESP32, bitmap generator, monochrome graphics"
		/>
		<meta name="author" content="kurogedelic" />

		<!-- Open Graph Meta Tags -->
		<meta property="og:title" content="BitsDraw - U8G2 Bitmap Editor" />
		<meta
			property="og:description"
			content="Web-based bitmap editor for U8G2 displays. Create pixel art with real-time preview and export to C header files."
		/>
		<meta property="og:type" content="website" />
		<meta property="og:image" content="icons/BitsDraw.png" />

		<!-- Twitter Card Meta Tags -->
		<meta name="twitter:card" content="summary" />
		<meta name="twitter:title" content="BitsDraw - U8G2 Bitmap Editor" />
		<meta
			name="twitter:description"
			content="Web-based bitmap editor for U8G2 displays. Create pixel art with real-time preview and export to C header files."
		/>
		<meta name="twitter:image" content="icons/BitsDraw.png" />

		<!-- Favicon -->
		<link rel="icon" type="image/png" href="icons/BitsDraw.png" />
		<link rel="apple-touch-icon" href="icons/BitsDraw.png" />

		<!-- Theme Color -->
		<meta name="theme-color" content="#1a1a1a" />
		<meta name="msapplication-TileColor" content="#1a1a1a" />

		<!-- Styles -->
		<link rel="stylesheet" href="style.css" />

		<!-- Phosphor Icons -->
		<script src="https://unpkg.com/@phosphor-icons/web"></script>
	</head>
	<body>
		<!-- Menu Bar -->
		<div class="menu-bar">
			<div class="menu-item" data-menu="file">File</div>
			<div class="menu-item" data-menu="edit">Edit</div>
			<div class="menu-item" data-menu="image">Image</div>
			<div class="menu-item" data-menu="layer">Layer</div>
			<div class="menu-item" data-menu="effects">Effects</div>
			<div class="menu-item" data-menu="view">View</div>
			<div class="menu-item" data-menu="window">Window</div>
			<div class="menu-item" data-menu="help">Help</div>
			
			<!-- Cursor coordinates display -->
			<div class="menu-coordinates" id="cursor-coordinates">X:0 Y:0</div>
		</div>
		<!-- Sub Top Bar -->
		<div class="sub-top-bar" id="sub-top-bar">
			<!-- Tool Options Bar -->
			<div class="tool-options-bar" id="tool-options-bar">
				<!-- Active tool indicator -->
				<div class="active-tool-indicator" id="active-tool-indicator">
					<div class="active-tool-icon">
						<i class="ph ph-paint-brush" id="active-tool-icon"></i>
					</div>
					<div class="active-tool-name" id="active-tool-name">Brush</div>
				</div>
				<div class="tool-options-separator"></div>
				<!-- Tool options will be injected here dynamically -->
			</div>

			<!-- Canvas Controls Bar -->
			<div class="canvas-controls-bar" id="canvas-controls-bar">
				<div class="controls-content">
					<!-- Zoom Level -->
					<div class="control-group">
						<button
							class="dropdown-button"
							id="zoom-dropdown-btn"
							title="Zoom Level"
						>
							<span id="zoom-current-value">1x</span>
							<i class="ph ph-caret-down"></i>
						</button>
						<select id="zoom-select" style="display: none">
							<option value="1" selected>1x</option>
							<option value="2">2x</option>
							<option value="4">4x</option>
							<option value="8">8x</option>
							<option value="16">16x</option>
							<option value="32">32x</option>
						</select>
					</div>

					<!-- Zoom Buttons -->
					<div class="control-group">
						<div class="zoom-buttons">
							<button id="zoom-out-btn" title="Zoom Out" class="btn-toggle">
								<i class="ph ph-magnifying-glass-minus"></i>
							</button>
							<button id="zoom-in-btn" title="Zoom In" class="btn-toggle">
								<i class="ph ph-magnifying-glass-plus"></i>
							</button>
						</div>
					</div>

					<!-- Display Mode -->
					<div class="control-group">
						<button
							class="dropdown-button"
							id="display-dropdown-btn"
							title="Display Mode"
						>
							<span id="display-mode-name">Black</span>
							<i class="ph ph-caret-down"></i>
						</button>
						<select id="display-mode-select" style="display: none">
							<option value="black" selected>Black</option>
							<option value="white">White</option>
							<option value="lcd-classic">LCD Classic</option>
							<option value="lcd-inverted">LCD Inverted</option>
							<option value="night-blue">Night Blue</option>
							<option value="night-green">Night Green</option>
							<option value="amber">Amber</option>
							<option value="terminal">Terminal</option>
							<option value="blue">Blue</option>
							<option value="paper-white">Paper White</option>
							<option value="e-ink-gray">E-Ink Gray</option>
							<option value="playdate">Playdate</option>
						</select>
					</div>

					<!-- Grid and Guides -->
					<div class="control-group">
						<div class="grid-buttons">
							<button id="show-grid-btn" title="Show Grid" class="btn-toggle">
								<i class="ph ph-grid-four"></i>
							</button>
							<button
								id="show-guides-btn"
								title="Show Guides"
								class="btn-toggle"
							>
								<i class="ph ph-bounding-box"></i>
							</button>
							<button
								id="pixel-perfect-preview-btn"
								title="Pixel-Perfect Preview"
								class="btn-toggle"
							>
								<i class="ph ph-crosshair"></i>
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- Menus -->

		<div class="menu-dropdown" id="menu-file">
			<div class="menu-dropdown-item" data-action="new">
				<i class="ph ph-file-plus"></i>
				<span>New Project...</span>
				<span class="menu-shortcut">⌃N</span>
			</div>
			<div class="menu-dropdown-item" data-action="open">
				<i class="ph ph-folder-open"></i>
				<span>Open Project...</span>
				<span class="menu-shortcut">⌃O</span>
			</div>
			<div class="menu-dropdown-item" data-action="recent-projects">
				<i class="ph ph-clock-clockwise"></i>
				<span>Recent Projects...</span>
			</div>
			<div class="menu-divider"></div>
			<div class="menu-dropdown-item" data-action="save">
				<i class="ph ph-floppy-disk"></i>
				<span>Save Project</span>
				<span class="menu-shortcut">⌃S</span>
			</div>
			<div class="menu-dropdown-item" data-action="save-as">
				<i class="ph ph-floppy-disk"></i>
				<span>Save Project As...</span>
			</div>
			<div class="menu-dropdown-item" data-action="export-project">
				<i class="ph ph-export"></i>
				<span>Export Project (.bdp)</span>
			</div>
			<div class="menu-divider"></div>
			<div class="menu-dropdown-item has-submenu" data-action="import">
				<i class="ph ph-download"></i>
				<span>Import</span>
				<span class="menu-arrow">▶</span>
			</div>
			<div class="menu-submenu" id="submenu-import">
				<div class="menu-dropdown-item" data-action="import-image">
					<i class="ph ph-image"></i>
					<span>Image...</span>
				</div>
				<div class="menu-dropdown-item" data-action="import-cpp">
					<i class="ph ph-file-code"></i>
					<span>CPP Header File...</span>
				</div>
				<div class="menu-dropdown-item" data-action="import-text-objects">
					<i class="ph ph-text-aa"></i>
					<span>Text Objects...</span>
				</div>
			</div>
			<div class="menu-dropdown-item has-submenu" data-action="export">
				<i class="ph ph-upload"></i>
				<span>Export</span>
				<span class="menu-arrow">▶</span>
			</div>
			<div class="menu-submenu" id="submenu-export">
				<!-- Most Common - Image Formats -->
				<div class="menu-dropdown-item" data-action="export-png">
					<i class="ph ph-image"></i>
					<span>PNG Image</span>
				</div>
				<div class="menu-dropdown-item" data-action="export-gif" id="export-gif-menu">
					<i class="ph ph-play-circle"></i>
					<span>Animation</span>
				</div>
				<!-- WebP export removed -->
				
				<!-- Hardware/Development -->
				<div class="menu-dropdown-item" data-action="export-cpp">
					<i class="ph ph-file-code"></i>
					<span>CPP header file (u8g2)</span>
					<span class="menu-shortcut">⌃E</span>
				</div>
				<!-- Raw Binary and ASCII Art export removed -->
				<div class="menu-divider"></div>
				
				<!-- Text Objects -->
				<div class="menu-dropdown-item" data-action="export-text-objects">
					<i class="ph ph-text-aa"></i>
					<span>Text Objects...</span>
				</div>
				
				<!-- All Formats -->
				<div class="menu-dropdown-item" data-action="export-formats">
					<i class="ph ph-list"></i>
					<span>All Formats...</span>
				</div>
			</div>
		</div>

		<div class="menu-dropdown" id="menu-edit">
			<div class="menu-dropdown-item" data-action="undo">
				<i class="ph ph-arrow-counter-clockwise"></i>
				<span>Undo</span>
				<span class="menu-shortcut">⌃Z</span>
			</div>
			<div class="menu-dropdown-item" data-action="redo">
				<i class="ph ph-arrow-clockwise"></i>
				<span>Redo</span>
				<span class="menu-shortcut">⌃Y</span>
			</div>
			<div class="menu-divider"></div>
			<div class="menu-dropdown-item" data-action="cut">
				<i class="ph ph-scissors"></i>
				<span>Cut</span>
				<span class="menu-shortcut">⌃X</span>
			</div>
			<div class="menu-dropdown-item" data-action="copy">
				<i class="ph ph-copy"></i>
				<span>Copy</span>
				<span class="menu-shortcut">⌃C</span>
			</div>
			<div class="menu-dropdown-item" data-action="paste">
				<i class="ph ph-clipboard"></i>
				<span>Paste</span>
				<span class="menu-shortcut">⌃V</span>
			</div>
			<div class="menu-dropdown-item" data-action="select-all">
				<i class="ph ph-selection-all"></i>
				<span>Select All</span>
				<span class="menu-shortcut">⌃A</span>
			</div>
			<div class="menu-divider"></div>
			<div class="menu-dropdown-item" data-action="clear-selection">
				<i class="ph ph-selection"></i>
				<span>Clear Selection</span>
				<span class="menu-shortcut">Delete</span>
			</div>
		</div>

		<div class="menu-dropdown" id="menu-image">
			<div class="menu-dropdown-item" data-action="canvas-resize">
				<i class="ph ph-resize"></i>
				<span>Canvas Size...</span>
				<span class="menu-shortcut">⌃⇧C</span>
			</div>
			<div class="menu-divider"></div>
			<div class="menu-dropdown-item has-submenu" data-action="transform">
				<i class="ph ph-arrows-out"></i>
				<span>Transform</span>
				<span class="menu-arrow">▶</span>
			</div>
		</div>

		<div class="menu-submenu" id="submenu-transform">
			<div class="menu-dropdown-item" data-action="rotate-90">
				<i class="ph ph-arrow-clockwise"></i>
				<span>Rotate 90° CW</span>
			</div>
			<div class="menu-dropdown-item" data-action="rotate-180">
				<i class="ph ph-arrow-clockwise"></i>
				<span>Rotate 180°</span>
			</div>
			<div class="menu-dropdown-item" data-action="rotate-270">
				<i class="ph ph-arrow-counter-clockwise"></i>
				<span>Rotate 270° CW</span>
			</div>
			<div class="menu-divider"></div>
			<div class="menu-dropdown-item" data-action="flip-horizontal">
				<i class="ph ph-flip-horizontal"></i>
				<span>Flip Horizontal</span>
			</div>
			<div class="menu-dropdown-item" data-action="flip-vertical">
				<i class="ph ph-flip-vertical"></i>
				<span>Flip Vertical</span>
			</div>
		</div>

		<div class="menu-dropdown" id="menu-effects">
			<div class="menu-dropdown-item" data-action="invert-bitmap">
				<i class="ph-fill ph-subtract-square"></i>
				<span>Invert</span>
			</div>
			<div class="menu-dropdown-item" data-action="dithering">
				<i class="ph-fill ph-subtract-square"></i>
				<span>Dithering...</span>
			</div>
			<div class="menu-dropdown-item" data-action="draw-edge">
				<i class="ph ph-path"></i>
				<span>Draw Edge...</span>
			</div>
		</div>

		<div class="menu-dropdown" id="menu-layer">
			<div class="menu-dropdown-item" data-action="layer-flip-horizontal">
				<i class="ph ph-flip-horizontal"></i>
				<span>Flip Horizontal</span>
			</div>
			<div class="menu-dropdown-item" data-action="layer-flip-vertical">
				<i class="ph ph-flip-vertical"></i>
				<span>Flip Vertical</span>
			</div>
			<div class="menu-divider"></div>
			<div class="menu-dropdown-item" data-action="layer-rotate-90">
				<i class="ph ph-arrow-clockwise"></i>
				<span>Rotate 90° CW</span>
			</div>
			<div class="menu-dropdown-item" data-action="layer-rotate-180">
				<i class="ph ph-arrow-clockwise"></i>
				<span>Rotate 180°</span>
			</div>
			<div class="menu-dropdown-item" data-action="layer-rotate-270">
				<i class="ph ph-arrow-counter-clockwise"></i>
				<span>Rotate 270° CW</span>
			</div>
		</div>

		<div class="menu-dropdown" id="menu-view">
			<div class="menu-dropdown-item" data-action="view-canvas">
				<i class="ph ph-grid-four"></i>
				<span>Canvas View</span>
				<span class="menu-shortcut">⌃1</span>
			</div>
			<div class="menu-divider"></div>
			<div class="menu-dropdown-item" data-action="zoom-in">
				<i class="ph ph-magnifying-glass-plus"></i>
				<span>Zoom In</span>
				<span class="menu-shortcut">⌃=</span>
			</div>
			<div class="menu-dropdown-item" data-action="zoom-out">
				<i class="ph ph-magnifying-glass-minus"></i>
				<span>Zoom Out</span>
				<span class="menu-shortcut">⌃-</span>
			</div>
			<div class="menu-divider"></div>
			<div class="menu-dropdown-item" data-action="show-grid">
				<i class="ph ph-grid-four"></i>
				<span>Show Grid</span>
				<span class="menu-shortcut">⌃G</span>
			</div>
			<div class="menu-dropdown-item" data-action="show-guides">
				<i class="ph ph-bounding-box"></i>
				<span>Show Guides</span>
			</div>
			<div class="menu-divider"></div>
			<div class="menu-dropdown-item has-submenu" data-action="appearance">
				<i class="ph ph-palette"></i>
				<span>Appearance</span>
				<span class="menu-arrow">▶</span>
			</div>
		</div>

		<div class="menu-submenu" id="submenu-appearance">
			<div class="menu-dropdown-item" data-action="theme-auto">
				<i class="ph-fill ph-sun-horizon"></i>
				<span>Auto</span>
			</div>
			<div class="menu-dropdown-item" data-action="theme-light">
				<i class="ph-fill ph-sun"></i>
				<span>Light</span>
			</div>
			<div class="menu-dropdown-item" data-action="theme-dark">
				<i class="ph-fill ph-moon"></i>
				<span>Dark</span>
			</div>
		</div>

		<div class="menu-dropdown" id="menu-window">
			<div class="menu-dropdown-item" data-action="show-tools">
				<i class="ph ph-check-square" data-window-icon="tools-window"></i>
				<span>Tools</span>
			</div>
			<div class="menu-dropdown-item" data-action="show-colors">
				<i class="ph ph-check-square" data-window-icon="colors-window"></i>
				<span>Patterns</span>
			</div>
			<div class="menu-dropdown-item" data-action="show-options">
				<i class="ph ph-check-square" data-window-icon="options-window"></i>
				<span>Options</span>
			</div>
			<div class="menu-dropdown-item" data-action="show-layers">
				<i class="ph ph-check-square" data-window-icon="layers-window"></i>
				<span>Layers</span>
			</div>
			<div class="menu-dropdown-item" data-action="show-guides">
				<i class="ph ph-check-square" data-window-icon="guides-window"></i>
				<span>Guides</span>
			</div>
			<div class="menu-dropdown-item" data-action="show-preview">
				<i class="ph ph-check-square" data-window-icon="preview-window"></i>
				<span>Preview</span>
			</div>
			<div class="menu-dropdown-item" data-action="show-canvas-controls">
				<i
					class="ph ph-check-square"
					data-window-icon="canvas-controls-window"
				></i>
				<span>Controls</span>
			</div>
			<div class="menu-dropdown-item" data-action="show-sheets">
				<i class="ph ph-check-square" data-window-icon="sheets-panel"></i>
				<span>Sheets</span>
			</div>
		</div>

		<div class="menu-dropdown" id="menu-help">
			<div class="menu-dropdown-item" data-action="about">
				<i class="ph ph-info"></i>
				<span>About BitsDraw...</span>
			</div>
			<div class="menu-divider"></div>
			<div class="menu-dropdown-item" data-action="shortcuts">
				<i class="ph ph-keyboard"></i>
				<span>Keyboard Shortcuts</span>
			</div>
		</div>

		<div class="desktop">
			<!-- Canvas Window -->
			<div
				class="window"
				id="canvas-window"
				style="left: 0px; top: 0px; width: 100%; height: 100%"
			>
				<div class="window-title-bar">
					<div class="window-title">Canvas - my_bitmap (480x320)</div>
				</div>
				<div class="window-content">
					<div class="canvas-area">
						<canvas id="bitmap-canvas"></canvas>
					</div>
				</div>
			</div>

			<!-- Sheets Panel -->
			<div
				class="panel"
				id="sheets-panel"
				style="
					position: fixed;
					bottom: 0;
					left: 8px;
					right: 8px;
					width: calc(100% - 16px);
					height: 200px;
					z-index: 20;
				"
			>
				<!-- Sheets Container -->
				<div class="sheets-container">
					<!-- Sheets List -->
					<div class="sheets-list" id="sheets-list">
						<!-- Sheets will be dynamically generated by JavaScript -->
					</div>
					
					<!-- Animation Controls Footer -->
					<div class="animation-footer">
						<!-- Left Controls -->
						<div class="animation-controls-left">
							<!-- Playback Controls -->
							<div class="playback-buttons">
								<button class="control-btn" id="play-btn" title="Play Animation">
									<i class="ph ph-play"></i>
								</button>
								<button class="control-btn" id="pause-btn" title="Pause Animation" style="display: none;">
									<i class="ph ph-pause"></i>
								</button>
								<button class="control-btn" id="stop-btn" title="Stop Animation">
									<i class="ph ph-stop"></i>
								</button>
							</div>
							
							<!-- Frame Controls -->
							<div class="frame-buttons">
								<button class="control-btn" id="first-frame-btn" title="First Frame">
									<i class="ph ph-skip-back"></i>
								</button>
								<button class="control-btn" id="prev-frame-btn" title="Previous Frame">
									<i class="ph ph-caret-left"></i>
								</button>
								<button class="control-btn" id="next-frame-btn" title="Next Frame">
									<i class="ph ph-caret-right"></i>
								</button>
								<button class="control-btn" id="last-frame-btn" title="Last Frame">
									<i class="ph ph-skip-forward"></i>
								</button>
							</div>
							
							<!-- Speed Control -->
							<div class="number-input">
								<button type="button" id="speed-decrease" title="Decrease Speed">-</button>
								<input type="number" id="animation-speed" min="1" max="30" value="12" title="Animation Speed (FPS)" />
								<button type="button" id="speed-increase" title="Increase Speed">+</button>
							</div>
							
							<!-- Loop Toggle -->
							<button class="btn-toggle active" id="loop-animation" title="Toggle Loop Animation">
								<i class="ph ph-repeat"></i>
							</button>
						</div>
						
						<!-- Right Controls -->
						<div class="animation-controls-right">
							<!-- Sheet Options -->
							<div class="sheet-options">
								<button
									class="panel-option-btn compact"
									id="add-sheet-btn"
									title="Add New Sheet"
								>
									<i class="ph ph-plus"></i>
								</button>
								<button
									class="panel-option-btn compact"
									id="duplicate-sheet-btn"
									title="Duplicate Current Sheet"
								>
									<i class="ph ph-copy"></i>
								</button>
								<button
									class="panel-option-btn compact"
									id="delete-sheet-btn"
									title="Delete Current Sheet"
								>
									<i class="ph ph-trash"></i>
								</button>
							</div>
							
							<!-- Onion Skinning -->
							<button class="btn-toggle" id="onion-skinning-btn" title="Toggle Onion Skinning">
								<i class="ph ph-stack"></i>
							</button>
							
							<!-- Frame Info -->
							<div class="frame-info">
								<span id="frame-counter">1 / 1</span>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Left Panel Column -->
			<div class="panel-column left-column" id="left-column">
				<!-- Tools Panel -->
				<div class="panel" id="tools-panel">
					<div class="panel-header collapsible">
						<div class="panel-title">
							<i class="ph-duotone ph-pencil-ruler"></i> Tools
						</div>
						<i class="ph ph-caret-down panel-caret"></i>
					</div>
					<div class="panel-content">
						<div class="tool-palette">
							<div class="tool-row">
								<button id="hand-tool" class="tool-icon" title="Hand">
									<i class="ph ph-hand"></i>
								</button>
								<button
									id="select-rect-tool"
									class="tool-icon"
									title="Rectangle Select"
								>
									<i class="ph ph-selection"></i>
								</button>
								<button
									id="select-circle-tool"
									class="tool-icon"
									title="Circle Select"
								>
									<i class="ph ph-circle-dashed"></i>
								</button>
								<div class="tool-spacer"></div>
							</div>
							<div class="tool-row">
								<button id="brush-tool" class="tool-icon active" title="Brush">
									<i class="ph ph-paint-brush"></i>
								</button>
								<button id="pencil-tool" class="tool-icon" title="Pencil">
									<i class="ph ph-pencil"></i>
								</button>
								<button id="eraser-tool" class="tool-icon" title="Eraser">
									<i class="ph ph-eraser"></i>
								</button>
								<div class="tool-spacer"></div>
							</div>
							<div class="tool-row">
								<button id="shapes-tool" class="tool-icon" title="Shapes">
									<i class="ph ph-shapes"></i>
								</button>
								<button id="line-tool" class="tool-icon" title="Line">
									<i class="ph ph-line-segment"></i>
								</button>
								<button id="text-tool" class="tool-icon" title="Text">
									<i class="ph ph-text-aa"></i>
								</button>
								<div class="tool-spacer"></div>
							</div>
							<div class="tool-row">
								<button id="bucket-tool" class="tool-icon" title="Bucket Fill">
									<i class="ph ph-paint-bucket"></i>
								</button>
								<button id="spray-tool" class="tool-icon" title="Spray">
									<i class="ph ph-spray-bottle"></i>
								</button>
								<div class="tool-spacer"></div>
								<div class="tool-spacer"></div>
							</div>
							<div class="tool-row">
								<button id="move-tool" class="tool-icon" title="Move">
									<i class="ph ph-arrows-out-cardinal"></i>
								</button>
								<button id="blur-tool" class="tool-icon" title="Blur">
									<i class="ph ph-drop-simple"></i>
								</button>
								<button id="guide-tool" class="tool-icon" title="Guide">
									<i class="ph ph-bounding-box"></i>
								</button>
								<div class="tool-spacer"></div>
							</div>
						</div>
					</div>
				</div>

				<!-- Patterns Panel -->
				<div class="panel" id="patterns-panel">
					<div class="panel-header collapsible">
						<div class="panel-title">
							<i class="ph-duotone ph-checkerboard"></i> Patterns
						</div>
						<i class="ph ph-caret-down panel-caret"></i>
					</div>
					<div class="panel-content">
						<div class="pattern-controls">
							<button id="delete-pattern-btn" title="Delete Selected Pattern">
								<i class="ph ph-minus"></i>
							</button>
							<button id="add-pattern-btn" title="Add New Pattern">
								<i class="ph ph-plus"></i>
							</button>
						</div>
						<div class="color-palette">
							<!-- Patterns will be dynamically populated -->
						</div>
					</div>
				</div>

				<!-- Colour Panel -->
				<div class="panel" id="color-panel">
					<div class="panel-header collapsible">
						<div class="panel-title">
							<i class="ph-duotone ph-palette"></i> Color
						</div>
						<i class="ph ph-caret-down panel-caret"></i>
					</div>
					<div class="panel-content">
						<div class="color-selector">
							<div class="color-blocks">
								<div
									class="color-block primary"
									id="primary-color"
									title="Left Click Color (Black)"
								>
									<div class="color-display" style="background: #000000"></div>
								</div>
								<div
									class="color-block secondary"
									id="secondary-color"
									title="Right Click Color (White)"
								>
									<div class="color-display" style="background: #ffffff"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Right Panel Column -->
			<div class="panel-column right-column" id="right-column">
			</div>

			<!-- About BitsDraw Modal -->
			<div class="dialog-overlay" id="about-dialog" style="display: none">
				<div class="dialog">
					<div class="dialog-header">
						<h3>About BitsDraw</h3>
						<button class="dialog-close" id="about-close-btn">
							<i class="ph ph-x"></i>
						</button>
					</div>
					<div class="dialog-content">
						<div class="about-content">
							<div class="about-icon">
								<img
									src="icons/BitsDraw.png"
									alt="BitsDraw"
									class="app-icon-image"
								/>
							</div>
							<div class="about-info">
								<h2>BitsDraw</h2>
								<p class="version">Version 1.0.5</p>
								<p class="description">Web-based bitmap editor</p>

								<div class="about-section">
									<h3>Copyright</h3>
									<p>© 2025 Leo Kuroshita. All rights reserved.</p>
									<p>Tribute for Bill Atkinson and Susan Kare.</p>
								</div>

								<div class="about-section">
									<h3>Support Development</h3>
									<p>If you find BitsDraw useful, consider supporting its development:</p>
									<a href="https://www.buymeacoffee.com/kurogek" target="_blank" class="coffee-link">
										<i class="ph ph-coffee"></i>
										Buy me a coffee
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Keyboard Shortcuts Window -->
			<div
				class="window hidden"
				id="shortcuts-window"
				style="left: 450px; top: 150px; width: 400px; height: 450px"
			>
				<div class="window-title-bar">
					<div class="window-controls">
						<div class="window-control close"><i class="ph ph-x"></i></div>
					</div>
					<div class="window-title">Keyboard Shortcuts</div>
				</div>
				<div class="window-content">
					<div class="shortcuts-content">
						<div class="shortcuts-section">
							<h3>File Operations</h3>
							<div class="shortcut-item">
								<span class="shortcut-key">⌃N</span>
								<span class="shortcut-desc">New Canvas</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">⌃S</span>
								<span class="shortcut-desc">Save</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">⌃O</span>
								<span class="shortcut-desc">Open</span>
							</div>
						</div>

						<div class="shortcuts-section">
							<h3>Edit Operations</h3>
							<div class="shortcut-item">
								<span class="shortcut-key">⌃Z</span>
								<span class="shortcut-desc">Undo</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">⌃Y</span>
								<span class="shortcut-desc">Redo</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">⌃A</span>
								<span class="shortcut-desc">Select All</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">⌃C</span>
								<span class="shortcut-desc">Copy Selection</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">⌃X</span>
								<span class="shortcut-desc">Cut Selection</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">⌃V</span>
								<span class="shortcut-desc">Paste Selection</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">Delete</span>
								<span class="shortcut-desc">Delete Selection</span>
							</div>
						</div>

						<div class="shortcuts-section">
							<h3>Tools</h3>
							<div class="shortcut-item">
								<span class="shortcut-key">P</span>
								<span class="shortcut-desc">Pencil Tool</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">B</span>
								<span class="shortcut-desc">Brush Tool</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">F</span>
								<span class="shortcut-desc">Bucket Fill</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">E</span>
								<span class="shortcut-desc">Eraser Tool</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">L</span>
								<span class="shortcut-desc">Line Tool</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">T</span>
								<span class="shortcut-desc">Text Tool</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">R</span>
								<span class="shortcut-desc">Rectangle Tool</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">C</span>
								<span class="shortcut-desc">Circle Tool</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">S</span>
								<span class="shortcut-desc">Spray Tool</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">U</span>
								<span class="shortcut-desc">Blur Tool</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">M</span>
								<span class="shortcut-desc">Select Tool</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">V</span>
								<span class="shortcut-desc">Move Tool</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">H</span>
								<span class="shortcut-desc">Hand Tool</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">G</span>
								<span class="shortcut-desc">Guide Tool</span>
							</div>
						</div>

						<div class="shortcuts-section">
							<h3>View</h3>
							<div class="shortcut-item">
								<span class="shortcut-key">⌃=</span>
								<span class="shortcut-desc">Zoom In</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">⌃-</span>
								<span class="shortcut-desc">Zoom Out</span>
							</div>
							<div class="shortcut-item">
								<span class="shortcut-key">⌃G</span>
								<span class="shortcut-desc">Toggle Grid</span>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Right Panel Column -->
			<div class="panel-column right-column" id="right-column">
				<!-- Preview Panel -->
				<div class="panel" id="preview-panel">
					<div class="panel-header collapsible">
						<div class="panel-title">
							<i class="ph-duotone ph-monitor"></i> Preview
						</div>
						<i class="ph ph-caret-down panel-caret"></i>
					</div>
					<div class="panel-content">
						<div class="preview-area">
							<canvas id="preview-canvas"></canvas>
							<div class="viewport-overlay" id="viewport-overlay">
								<div class="viewport-frame"></div>
							</div>
						</div>
					</div>
				</div>

				<!-- Layers Panel -->
				<div class="panel" id="layers-panel">
					<div class="panel-header collapsible">
						<div class="panel-title">
							<i class="ph-duotone ph-stack"></i> Layers
						</div>
						<i class="ph ph-caret-down panel-caret"></i>
					</div>
					<div class="panel-content">
						<div class="layer-controls">
							<button id="add-layer-btn" title="Add Layer">
								<i class="ph ph-plus"></i>
							</button>
							<button id="delete-layer-btn" title="Delete Layer">
								<i class="ph ph-trash"></i>
							</button>
							<button id="duplicate-layer-btn" title="Duplicate Layer">
								<i class="ph ph-copy"></i>
							</button>
							<button id="select-all-layers-btn" title="Select All Layers">
								<i class="ph ph-check-square"></i>
							</button>
						</div>
						<div
							class="layer-batch-controls"
							id="layer-batch-controls"
							style="display: none"
						>
							<button id="batch-delete-btn" title="Delete Selected Layers">
								<i class="ph ph-trash"></i> Delete Selected
							</button>
							<button id="combine-layers-btn" title="Combine Selected Layers">
								<i class="ph ph-unite"></i> Combine
							</button>
							<button id="clear-selection-btn" title="Clear Selection">
								<i class="ph ph-x"></i>
							</button>
						</div>
						<div class="layer-list" id="layer-list">
							<!-- Layers will be dynamically added here -->
						</div>
					</div>
				</div>

				<!-- Guides Panel -->
				<div class="panel" id="guides-panel">
					<div class="panel-header collapsible">
						<div class="panel-title">
							<i class="ph-duotone ph-bounding-box"></i> Guides
						</div>
						<i class="ph ph-caret-down panel-caret"></i>
					</div>
					<div class="panel-content">
						<div class="guides-controls">
							<button id="add-guide-btn" title="Add Guide">
								<i class="ph ph-plus"></i>
							</button>
							<button id="import-guides-btn" title="Import Guides">
								<i class="ph ph-upload"></i>
							</button>
							<button id="export-guides-btn" title="Export Guides">
								<i class="ph ph-download"></i>
							</button>
							<button id="sort-guides-btn" title="Toggle Sort by Name">
								<i class="ph ph-sort-ascending"></i>
							</button>
							<button id="clear-guides-btn" title="Clear All">
								<i class="ph ph-trash"></i>
							</button>
						</div>
						<div class="guides-list" id="guides-list">
							<!-- Guides will be dynamically added here -->
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- New Canvas Dialog -->
		<div class="dialog-overlay" id="new-canvas-dialog" style="display: none">
			<div class="dialog">
				<div class="dialog-header">
					<h3>New Canvas</h3>
					<button class="dialog-close" id="new-canvas-close-btn">
						<i class="ph ph-x"></i>
					</button>
				</div>
				<div class="dialog-content">
					<div class="preset-section">
						<h4>Preset</h4>
						<select id="preset-select">
							<option value="">Custom Size</option>
							<option value="480,320" selected>Standard 480×320</option>
							<option value="720,576">Mac Paint 720×576</option>
							<option value="128,64">OLED 128×64</option>
							<option value="128,32">OLED 128×32</option>
							<option value="72,40">OLED 72×40</option>
							<option value="400,240">Playdate 400×240</option>
							<option value="512,342">Classic Mac 512×342</option>
							<option value="640,480">VGA 640×480</option>
							<option value="720,350">MDA 720×350</option>
							<option value="800,600">SVGA 800×600</option>
							<option value="1024,768">XGA 1024×768</option>
							<option value="160,144">Game Boy 160×144</option>
						</select>
					</div>
					<div class="custom-section">
						<h4>Project</h4>
						<div class="project-inputs">
							<label>
								Project Name:
								<input
									type="text"
									id="project-name"
									value="my_bitmap"
									placeholder="Enter project name"
								/>
							</label>
						</div>
					</div>
					<div class="custom-section">
						<h4>Background</h4>
						<div class="background-inputs">
							<label for="background-color">Background Layer:</label>
							<select id="background-color">
								<option value="white" selected>White (Opaque)</option>
								<option value="black">Black (Opaque)</option>
								<option value="transparent">Transparent</option>
							</select>
						</div>
					</div>
					<div class="custom-section">
						<h4>Size</h4>
						<div class="size-inputs">
							<label>
								Width:
								<input
									type="number"
									id="canvas-width"
									min="1"
									max="2048"
									value="480"
								/>
							</label>
							<label>
								Height:
								<input
									type="number"
									id="canvas-height"
									min="1"
									max="2048"
									value="320"
								/>
							</label>
							<button
								id="swap-dimensions-btn"
								type="button"
								title="Swap Width/Height"
							>
								<i class="ph ph-arrow-bend-up-right"></i>
							</button>
						</div>
					</div>
				</div>
				<div class="dialog-footer">
					<button
						class="dialog-btn dialog-btn-cancel"
						id="new-canvas-cancel-btn"
					>
						Cancel
					</button>
					<button
						class="dialog-btn dialog-btn-primary"
						id="new-canvas-create-btn"
					>
						Create
					</button>
				</div>
			</div>
		</div>

		<!-- Canvas Resize Dialog -->
		<div class="dialog-overlay" id="canvas-resize-dialog" style="display: none">
			<div class="dialog">
				<div class="dialog-header">
					<h3>Resize Canvas</h3>
					<button class="dialog-close" id="canvas-resize-close-btn">
						<i class="ph ph-x"></i>
					</button>
				</div>
				<div class="dialog-content">
					<div class="current-size-section">
						<h4>Current Size</h4>
						<div class="size-display">
							<span id="current-canvas-width">480</span> × <span id="current-canvas-height">320</span> pixels
						</div>
					</div>

					<div class="resize-section">
						<h4>New Size</h4>
						<div class="size-inputs">
							<div class="input-group">
								<label for="resize-width">Width</label>
								<input
									type="number"
									id="resize-width"
									min="1"
									max="4096"
									value="480"
								/>
								<span class="unit">px</span>
							</div>
							<div class="input-group">
								<label for="resize-height">Height</label>
								<input
									type="number"
									id="resize-height"
									min="1"
									max="4096"
									value="320"
								/>
								<span class="unit">px</span>
							</div>
						</div>
						
						<div class="constraint-controls">
							<label class="checkbox-label">
								<input type="checkbox" id="maintain-aspect-ratio" checked>
								<span class="checkmark"></span>
								Maintain aspect ratio
							</label>
						</div>
					</div>

					<div class="preset-section">
						<h4>Common Sizes</h4>
						<div class="preset-buttons">
							<button class="preset-btn" data-size="128,64">OLED 128×64</button>
							<button class="preset-btn" data-size="128,32">OLED 128×32</button>
							<button class="preset-btn" data-size="400,240">Playdate 400×240</button>
							<button class="preset-btn" data-size="160,144">Game Boy 160×144</button>
							<button class="preset-btn" data-size="256,192">Standard 256×192</button>
							<button class="preset-btn" data-size="480,320">Standard 480×320</button>
							<button class="preset-btn" data-size="720,576">Mac Paint 720×576</button>
							<button class="preset-btn" data-size="1024,768">Large 1024×768</button>
						</div>
					</div>

					<div class="resize-options-section">
						<h4>Resize Options</h4>
						<div class="resize-options">
							<label class="radio-label">
								<input type="radio" name="resize-anchor" value="top-left" checked>
								<span class="radio-mark"></span>
								<span class="label-text">Top-Left (preserve top-left corner)</span>
							</label>
							<label class="radio-label">
								<input type="radio" name="resize-anchor" value="center">
								<span class="radio-mark"></span>
								<span class="label-text">Center (center content)</span>
							</label>
							<label class="radio-label">
								<input type="radio" name="resize-anchor" value="bottom-right">
								<span class="radio-mark"></span>
								<span class="label-text">Bottom-Right (preserve bottom-right corner)</span>
							</label>
						</div>
						
						<div class="fill-options">
							<label for="fill-color">Fill new areas with:</label>
							<select id="fill-color">
								<option value="transparent">Transparent</option>
								<option value="white" selected>White</option>
								<option value="black">Black</option>
							</select>
						</div>
					</div>

					<div class="warning-section" id="resize-warning" style="display: none;">
						<div class="warning-content">
							<i class="ph ph-warning"></i>
							<span id="resize-warning-text">Warning message will appear here</span>
						</div>
					</div>
				</div>
				<div class="dialog-footer">
					<button
						class="dialog-btn dialog-btn-cancel"
						id="canvas-resize-cancel-btn"
					>
						Cancel
					</button>
					<button
						class="dialog-btn dialog-btn-primary"
						id="canvas-resize-apply-btn"
					>
						Apply Resize
					</button>
				</div>
			</div>
		</div>

		<!-- Brush Cursor Overlay -->
		<div class="brush-cursor-overlay" id="brush-cursor-overlay"></div>

		<!-- Hidden file input for image import -->
		<input
			type="file"
			id="file-input"
			accept=".png,.jpg,.jpeg,.gif,.webp,.avif,.bmp,.ico,.tiff,.tif,.svg,image/*"
			style="
				position: absolute;
				left: -9999px;
				top: -9999px;
				opacity: 0;
				width: 1px;
				height: 1px;
				z-index: -1;
			"
		/>

		<!-- CPP Export Dialog -->
		<div class="dialog-overlay" id="cpp-export-dialog" style="display: none">
			<div class="dialog">
				<div class="dialog-header">
					<h3>Export CPP Header File</h3>
					<button class="dialog-close" id="cpp-export-close-btn">
						<i class="ph ph-x"></i>
					</button>
				</div>
				<div class="dialog-content">
					<div class="input-section">
						<label for="export-format-select">Format:</label>
						<select id="export-format-select">
							<option value="u8g2">U8G2 (XBM, LSB first)</option>
							<option value="adafruit">Adafruit GFX (MSB first)</option>
							<!-- Playdate PDI removed -->
							<option value="gameboy">Game Boy 2BPP</option>
						</select>
					</div>
					<div class="input-section">
						<label for="array-name-input">Array Name:</label>
						<input
							type="text"
							id="array-name-input"
							value="my_bitmap"
							placeholder="my_bitmap"
						/>
					</div>
					<div class="code-section">
						<label for="cpp-export-code">Generated Code:</label>
						<textarea id="cpp-export-code" readonly rows="15"></textarea>
					</div>
				</div>
				<div class="dialog-footer">
					<button
						class="dialog-btn dialog-btn-cancel"
						id="cpp-export-cancel-btn"
					>
						Cancel
					</button>
					<button
						class="dialog-btn dialog-btn-primary"
						id="cpp-export-copy-btn"
					>
						Copy .h Code
					</button>
				</div>
			</div>
		</div>

		<!-- CPP Import Dialog -->
		<div class="dialog-overlay" id="cpp-import-dialog" style="display: none">
			<div class="dialog">
				<div class="dialog-header">
					<h3>Import CPP Header File</h3>
					<button class="dialog-close" id="cpp-import-close-btn">
						<i class="ph ph-x"></i>
					</button>
				</div>
				<div class="dialog-content">
					<div class="import-section">
						<label for="cpp-import-file">Select .h file:</label>
						<input type="file" id="cpp-import-file" accept=".h,.txt" />
						<p class="help-text">Or paste code below:</p>
						<textarea
							id="cpp-import-code"
							placeholder="Paste .h code here..."
							rows="10"
						></textarea>
					</div>
				</div>
				<div class="dialog-footer">
					<button
						class="dialog-btn dialog-btn-cancel"
						id="cpp-import-cancel-btn"
					>
						Cancel
					</button>
					<button
						class="dialog-btn dialog-btn-primary"
						id="cpp-import-load-btn"
					>
						Import
					</button>
				</div>
			</div>
		</div>

		<!-- Image Placement Dialog -->
		<div
			class="dialog-overlay"
			id="image-placement-dialog"
			style="display: none"
		>
			<div class="dialog image-placement-dialog">
				<div class="dialog-header">
					<h3>Place Image</h3>
					<button class="dialog-close" id="image-placement-close-btn">
						<i class="ph ph-x"></i>
					</button>
				</div>
				<div class="dialog-content">
					<div class="image-placement-content">
						<div class="placement-preview">
							<div class="preview-container">
								<canvas
									id="placement-preview-canvas"
									class="placement-canvas"
								></canvas>
								<div
									class="resize-handles"
									id="resize-handles"
									style="display: none"
								>
									<div class="resize-handle nw" data-direction="nw"></div>
									<div class="resize-handle ne" data-direction="ne"></div>
									<div class="resize-handle sw" data-direction="sw"></div>
									<div class="resize-handle se" data-direction="se"></div>
									<div class="resize-handle n" data-direction="n"></div>
									<div class="resize-handle s" data-direction="s"></div>
									<div class="resize-handle w" data-direction="w"></div>
									<div class="resize-handle e" data-direction="e"></div>
								</div>
							</div>
						</div>
						<div class="placement-controls">
							<div class="control-group">
								<label>Size Options:</label>
								<div class="size-buttons">
									<button class="dialog-btn" id="original-size-btn">
										100% Original Size
									</button>
									<button class="dialog-btn" id="fit-canvas-btn">
										Stretch to Fit Canvas
									</button>
								</div>
							</div>
							<div class="control-group">
								<label>Image Information:</label>
								<div class="image-info">
									<span id="original-dimensions">Original: -</span>
									<span id="current-dimensions">Current: -</span>
									<span id="canvas-dimensions">Canvas: -</span>
								</div>
							</div>
							<div class="threshold-control">
								<label>Threshold: <span id="threshold-value">128</span></label>
								<div class="threshold-slider-container">
									<input
										type="range"
										id="threshold-slider"
										min="0"
										max="255"
										value="128"
									/>
								</div>
							</div>
							<div class="control-group">
								<label>Transparency Handling:</label>
								<select id="alpha-handling-select">
									<option value="blend">Blend with White</option>
									<option value="transparent-white">Transparent → White</option>
									<option value="transparent-black">Transparent → Black</option>
								</select>
							</div>
							<div class="control-group">
								<label>Conversion Method:</label>
								<select id="dither-method-select">
									<option value="threshold">Simple Threshold</option>
									<option value="floyd-steinberg">
										Floyd-Steinberg Dithering
									</option>
									<option value="atkinson">Atkinson Dithering</option>
									<option value="burkes">Burkes Dithering</option>
									<option value="bayer-2x2">Bayer 2×2 Dithering</option>
									<option value="bayer-4x4">Bayer 4×4 Dithering</option>
									<option value="bayer-8x8">Bayer 8×8 Dithering</option>
								</select>
							</div>
							<div class="control-group">
								<label>Color Processing:</label>
								<div class="checkbox-group">
									<label
										><input type="checkbox" id="invert-colors-checkbox" />
										Invert Colors</label
									>
								</div>
							</div>
							<div class="control-group">
								<label>Alpha Channel Mode:</label>
								<select id="alpha-mode-select">
									<option value="ignore">Ignore Alpha (Opaque)</option>
									<option value="preserve">Preserve Original Alpha</option>
									<option value="white-to-alpha">White → Transparent</option>
									<option value="black-to-alpha">Black → Transparent</option>
									<option value="no-alpha">Force Opaque</option>
								</select>
							</div>
						</div>
					</div>
				</div>
				<div class="dialog-footer">
					<button
						class="dialog-btn dialog-btn-cancel"
						id="image-placement-cancel-btn"
					>
						Cancel
					</button>
					<button
						class="dialog-btn dialog-btn-primary"
						id="image-placement-apply-btn"
					>
						Apply
					</button>
				</div>
			</div>
		</div>

		<!-- Dithering Dialog -->
		<div class="dialog-overlay" id="dithering-dialog" style="display: none">
			<div class="dialog dithering-dialog-simple">
				<div class="dialog-header">
					<h3>Dithering</h3>
					<button class="dialog-close" id="dithering-close-btn">
						<i class="ph ph-x"></i>
					</button>
				</div>
				<div class="dialog-content">
					<!-- Single Preview Canvas -->
					<div class="dithering-preview-simple">
						<canvas id="dithering-preview-canvas"></canvas>
					</div>
					
					<!-- Minimal Controls -->
					<div class="dithering-controls-simple">
						<div class="control-row">
							<label>Method:</label>
							<select id="dithering-method">
								<option value="Bayer2x2">Bayer 2×2</option>
								<option value="Bayer4x4" selected>Bayer 4×4</option>
								<option value="Bayer8x8">Bayer 8×8</option>
								<option value="FloydSteinberg">Floyd-Steinberg</option>
								<option value="Burkes">Burkes</option>
								<option value="Atkinson">Atkinson</option>
							</select>
						</div>
						<div class="control-row">
							<label>Intensity: <span id="dithering-alpha-value">100%</span></label>
							<input type="range" id="dithering-alpha" min="0" max="100" value="100" step="1" />
						</div>
						<div class="control-row">
							<label><input type="checkbox" id="dithering-alpha-channel" /> Dither Transparency</label>
						</div>
					</div>
				</div>
				<div class="dialog-footer">
					<button class="dialog-btn dialog-btn-cancel" id="dithering-cancel-btn">Cancel</button>
					<button class="dialog-btn dialog-btn-primary" id="dithering-apply-btn">Apply</button>
				</div>
			</div>
		</div>

		<!-- Draw Edge Dialog -->
		<div class="dialog-overlay" id="draw-edge-dialog" style="display: none">
			<div class="dialog">
				<div class="dialog-header">
					<h3>Draw Edge</h3>
					<button class="dialog-close" id="draw-edge-close-btn">
						<i class="ph ph-x"></i>
					</button>
				</div>
				<div class="dialog-content">
					<div class="control-group">
						<label>Edge Width: <span id="edge-width-value">1</span>px</label>
						<input type="range" id="edge-width" min="1" max="5" value="1" />
					</div>
					<div class="control-group">
						<label>Edge Color:</label>
						<select id="edge-color">
							<option value="black">Black (Opaque)</option>
							<option value="white">White (Opaque)</option>
							<option value="transparent">Transparent (Erase)</option>
							<option value="pattern">Current Pattern</option>
						</select>
					</div>
					<div class="control-group">
						<label>Detection:</label>
						<div class="checkbox-group">
							<label
								><input type="checkbox" id="detect-alpha-edges" checked /> Alpha
								Channel Edges</label
							>
							<label
								><input type="checkbox" id="detect-bitmap-edges" checked />
								Bitmap Color Edges</label
							>
						</div>
					</div>
					<div class="control-group">
						<label>Preview:</label>
						<canvas id="edge-preview-canvas" width="200" height="150"></canvas>
						<button class="dialog-btn" id="edge-preview-update-btn">
							Update Preview
						</button>
					</div>
					<div class="info-text">
						Detects edges between transparent/opaque areas and black/white
						pixels.
					</div>
				</div>
				<div class="dialog-footer">
					<button
						class="dialog-btn dialog-btn-cancel"
						id="draw-edge-cancel-btn"
					>
						Cancel
					</button>
					<button
						class="dialog-btn dialog-btn-primary"
						id="draw-edge-apply-btn"
					>
						Apply
					</button>
				</div>
			</div>
		</div>

		<!-- Pattern Editor Dialog -->
		<div
			class="dialog-overlay"
			id="pattern-editor-dialog"
			style="display: none"
		>
			<div class="dialog">
				<div class="dialog-header">
					<h3>Pattern Editor</h3>
					<button class="dialog-close" id="pattern-editor-close-btn">
						<i class="ph ph-x"></i>
					</button>
				</div>
				<div class="dialog-content">
					<div class="pattern-editor-content">
						<div class="pattern-info">
							<label
								>Pattern Name:
								<input
									type="text"
									id="pattern-name-input"
									value=""
									placeholder="Pattern Name"
							/></label>
						</div>
						<div class="pattern-grid-container">
							<div class="pattern-grid" id="pattern-grid">
								<!-- 8x8 grid will be generated here -->
							</div>
						</div>
						<div class="pattern-controls">
							<button class="dialog-btn" id="pattern-clear-btn">Clear</button>
							<button class="dialog-btn" id="pattern-fill-btn">Fill</button>
							<button class="dialog-btn" id="pattern-invert-btn">Invert</button>
							<button class="dialog-btn" id="pattern-preset-checker-btn">
								Checker
							</button>
						</div>
						<div class="pattern-preview">
							<label>Preview:</label>
							<canvas
								id="pattern-preview-canvas"
								width="64"
								height="64"
							></canvas>
						</div>
					</div>
				</div>
				<div class="dialog-footer">
					<button
						class="dialog-btn dialog-btn-cancel"
						id="pattern-editor-cancel-btn"
					>
						Cancel
					</button>
					<button
						class="dialog-btn dialog-btn-primary"
						id="pattern-editor-save-btn"
					>
						Save
					</button>
				</div>
			</div>
		</div>

		<!-- Core utilities -->
		<script src="utils/optimizedBitmap.js"></script>
		<script src="utils/export.js"></script>
		<script src="utils/imageImport.js"></script>
		<script src="utils/patterns.js"></script>
		<script src="utils/textRenderer.js"></script>
		<script src="utils/multilineTextRenderer.js"></script>
		<script src="utils/textObjectManager.js"></script>
		<script src="utils/customFontManager.js"></script>
		<script src="utils/pngIconLoader.js"></script>
		<script src="utils/ditheringEffects.js"></script>

		<!-- Refactored managers -->
		<!-- Progress Manager removed -->
		<script src="utils/dialogManager.js"></script>
		<script src="utils/menuManager.js"></script>
		<script src="utils/windowManager.js"></script>
		<script src="utils/toolManager.js"></script>
		<script src="utils/imagePlacementDialog.js"></script>

		<!-- New Refactored Architecture -->
		<script src="src/core/EventBus.js"></script>
		<script src="src/core/StateManager.js"></script>
		<script src="src/core/CommandSystem.js"></script>
		<script src="src/tools/ToolSystem.js"></script>

		<!-- CanvasUnit System (Phase 1) -->
		<script src="src/core/CanvasUnit.js"></script>
		<script src="src/core/CanvasUnitManager.js"></script>
		<script src="src/core/LegacyAdapter.js"></script>

		<!-- Advanced Tools (Phase 4) -->

		<!-- Animation Export (Phase 5) -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/@pencil.js/canvas-gif-encoder@2.1.0/dist/canvas-gif-encoder.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.js"></script>
		<script src="utils/gifEncoder.js"></script>
		<script src="utils/animationExporter.js"></script>
		<script src="src/export/AnimationExporter.js"></script>
		<script src="src/ui/AnimationExportDialog.js"></script>

		<!-- Project Management (Phase 6) -->
		<script src="src/core/ProjectManager.js"></script>
		<script src="src/ui/ProjectDialog.js"></script>

		<script src="src/core/Application.js"></script>
		<script src="src/RefactorBridge.js"></script>
		<script src="src/RefactorMonitor.js"></script>

		<!-- Enhanced Error Handler -->
		<script src="utils/errorHandler.js"></script>

		<!-- Main application -->
		<script src="main.js"></script>
	</body>
</html>
