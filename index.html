<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BitsDraw</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="BitsDraw is a web-based bitmap editor specifically designed to generate U8G2-compatible bitmap data in .h file format. Create pixel art for OLED displays with real-time preview and multiple export formats.">
    <meta name="keywords" content="bitmap editor, U8G2, OLED display, pixel art, Arduino, ESP32, bitmap generator, monochrome graphics">
    <meta name="author" content="kurogedelic">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="BitsDraw - U8G2 Bitmap Editor">
    <meta property="og:description" content="Web-based bitmap editor for U8G2 displays. Create pixel art with real-time preview and export to C header files.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="/icons/BitsDraw.png">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="BitsDraw - U8G2 Bitmap Editor">
    <meta name="twitter:description" content="Web-based bitmap editor for U8G2 displays. Create pixel art with real-time preview and export to C header files.">
    <meta name="twitter:image" content="/icons/BitsDraw.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/icons/BitsDraw.png">
    <link rel="apple-touch-icon" href="/icons/BitsDraw.png">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#1a1a1a">
    <meta name="msapplication-TileColor" content="#1a1a1a">
    
    <!-- Styles -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
</head>
<body>
    <!-- Menu Bar -->
    <div class="menu-bar">
        <div class="menu-item" data-menu="file">File</div>
        <div class="menu-item" data-menu="edit">Edit</div>
        <div class="menu-item" data-menu="image">Image</div>
        <div class="menu-item" data-menu="effects">Effects</div>
        <div class="menu-item" data-menu="view">View</div>
        <div class="menu-item" data-menu="window">Window</div>
        <div class="menu-item" data-menu="help">Help</div>
    </div>

    <!-- Menus -->

    <div class="menu-dropdown" id="menu-file">
        <div class="menu-dropdown-item" data-action="new">
            <i class="ph ph-file-plus"></i>
            <span>New Project...</span>
            <span class="menu-shortcut">⌃N</span>
        </div>
        <div class="menu-dropdown-item" data-action="open">
            <i class="ph ph-folder-open"></i>
            <span>Open Project...</span>
            <span class="menu-shortcut">⌃O</span>
        </div>
        <div class="menu-dropdown-item" data-action="recent-projects">
            <i class="ph ph-clock-clockwise"></i>
            <span>Recent Projects...</span>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-dropdown-item" data-action="save">
            <i class="ph ph-floppy-disk"></i>
            <span>Save Project</span>
            <span class="menu-shortcut">⌃S</span>
        </div>
        <div class="menu-dropdown-item" data-action="save-as">
            <i class="ph ph-floppy-disk"></i>
            <span>Save Project As...</span>
        </div>
        <div class="menu-dropdown-item" data-action="export-project">
            <i class="ph ph-export"></i>
            <span>Export Project (.bdp)</span>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-dropdown-item has-submenu" data-action="import">
            <i class="ph ph-download"></i>
            <span>Import</span>
            <span class="menu-arrow">▶</span>
        </div>
        <div class="menu-submenu" id="submenu-import">
            <div class="menu-dropdown-item" data-action="import-image">
                <i class="ph ph-image"></i>
                <span>Image...</span>
            </div>
            <div class="menu-dropdown-item" data-action="import-cpp">
                <i class="ph ph-file-code"></i>
                <span>CPP Header File...</span>
            </div>
        </div>
        <div class="menu-dropdown-item has-submenu" data-action="export">
            <i class="ph ph-upload"></i>
            <span>Export</span>
            <span class="menu-arrow">▶</span>
        </div>
        <div class="menu-submenu" id="submenu-export">
            <div class="menu-dropdown-item" data-action="export-cpp">
                <i class="ph ph-file-code"></i>
                <span>CPP header file (u8g2)</span>
                <span class="menu-shortcut">⌃E</span>
            </div>
            <div class="menu-dropdown-item" data-action="export-png">
                <i class="ph ph-image"></i>
                <span>PNG</span>
            </div>
            <div class="menu-divider"></div>
        </div>
    </div>

    <div class="menu-dropdown" id="menu-edit">
        <div class="menu-dropdown-item" data-action="undo">
            <i class="ph ph-arrow-counter-clockwise"></i>
            <span>Undo</span>
            <span class="menu-shortcut">⌃Z</span>
        </div>
        <div class="menu-dropdown-item" data-action="redo">
            <i class="ph ph-arrow-clockwise"></i>
            <span>Redo</span>
            <span class="menu-shortcut">⌃Y</span>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-dropdown-item" data-action="cut">
            <i class="ph ph-scissors"></i>
            <span>Cut</span>
            <span class="menu-shortcut">⌃X</span>
        </div>
        <div class="menu-dropdown-item" data-action="copy">
            <i class="ph ph-copy"></i>
            <span>Copy</span>
            <span class="menu-shortcut">⌃C</span>
        </div>
        <div class="menu-dropdown-item" data-action="paste">
            <i class="ph ph-clipboard"></i>
            <span>Paste</span>
            <span class="menu-shortcut">⌃V</span>
        </div>
        <div class="menu-dropdown-item" data-action="select-all">
            <i class="ph ph-selection-all"></i>
            <span>Select All</span>
            <span class="menu-shortcut">⌃A</span>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-dropdown-item" data-action="clear-selection">
            <i class="ph ph-selection"></i>
            <span>Clear Selection</span>
            <span class="menu-shortcut">Delete</span>
        </div>
    </div>

    <div class="menu-dropdown" id="menu-image">
        <div class="menu-dropdown-item" data-action="rescale">
            <i class="ph ph-resize"></i>
            <span>Rescale Canvas...</span>
        </div>
        <div class="menu-dropdown-item has-submenu" data-action="transform">
            <i class="ph ph-arrows-out"></i>
            <span>Transform</span>
            <span class="menu-arrow">▶</span>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-dropdown-item" data-action="smart-conversions">
            <i class="ph ph-magic-wand"></i>
            <span>Smart Conversions...</span>
        </div>
    </div>

    <div class="menu-submenu" id="submenu-transform">
        <div class="menu-dropdown-item" data-action="rotate-90">
            <i class="ph ph-arrow-clockwise"></i>
            <span>Rotate 90° CW</span>
        </div>
        <div class="menu-dropdown-item" data-action="rotate-180">
            <i class="ph ph-arrow-clockwise"></i>
            <span>Rotate 180°</span>
        </div>
        <div class="menu-dropdown-item" data-action="rotate-270">
            <i class="ph ph-arrow-counter-clockwise"></i>
            <span>Rotate 270° CW</span>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-dropdown-item" data-action="flip-horizontal">
            <i class="ph ph-flip-horizontal"></i>
            <span>Flip Horizontal</span>
        </div>
        <div class="menu-dropdown-item" data-action="flip-vertical">
            <i class="ph ph-flip-vertical"></i>
            <span>Flip Vertical</span>
        </div>
    </div>

    <div class="menu-dropdown" id="menu-effects">
        <div class="menu-dropdown-item" data-action="invert-bitmap">
            <i class="ph-fill ph-subtract-square"></i>
            <span>Invert</span>
        </div>
        <div class="menu-dropdown-item" data-action="dithering">
            <i class="ph-fill ph-subtract-square"></i>
            <span>Dithering...</span>
        </div>
    </div>

    <div class="menu-dropdown" id="menu-view">
        <div class="menu-dropdown-item" data-action="view-canvas">
            <i class="ph ph-grid-four"></i>
            <span>Canvas View</span>
            <span class="menu-shortcut">⌃1</span>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-dropdown-item" data-action="zoom-in">
            <i class="ph ph-magnifying-glass-plus"></i>
            <span>Zoom In</span>
            <span class="menu-shortcut">⌃=</span>
        </div>
        <div class="menu-dropdown-item" data-action="zoom-out">
            <i class="ph ph-magnifying-glass-minus"></i>
            <span>Zoom Out</span>
            <span class="menu-shortcut">⌃-</span>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-dropdown-item" data-action="show-grid">
            <i class="ph ph-grid-four"></i>
            <span>Show Grid</span>
            <span class="menu-shortcut">⌃G</span>
        </div>
        <div class="menu-dropdown-item" data-action="show-guides">
            <i class="ph ph-bounding-box"></i>
            <span>Show Guides</span>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-dropdown-item has-submenu" data-action="appearance">
            <i class="ph ph-palette"></i>
            <span>Appearance</span>
            <span class="menu-arrow">▶</span>
        </div>
    </div>

    <div class="menu-submenu" id="submenu-appearance">
        <div class="menu-dropdown-item" data-action="theme-auto">
            <i class="ph-fill ph-sun-horizon"></i>
            <span>Auto</span>
        </div>
        <div class="menu-dropdown-item" data-action="theme-light">
            <i class="ph-fill ph-sun"></i>
            <span>Light</span>
        </div>
        <div class="menu-dropdown-item" data-action="theme-dark">
            <i class="ph-fill ph-moon"></i>
            <span>Dark</span>
        </div>
    </div>

    <div class="menu-dropdown" id="menu-window">
        <div class="menu-dropdown-item" data-action="show-tools">
            <i class="ph ph-check-square" data-window-icon="tools-window"></i>
            <span>Tools</span>
        </div>
        <div class="menu-dropdown-item" data-action="show-colors">
            <i class="ph ph-check-square" data-window-icon="colors-window"></i>
            <span>Patterns</span>
        </div>
        <div class="menu-dropdown-item" data-action="show-options">
            <i class="ph ph-check-square" data-window-icon="options-window"></i>
            <span>Options</span>
        </div>
        <div class="menu-dropdown-item" data-action="show-layers">
            <i class="ph ph-check-square" data-window-icon="layers-window"></i>
            <span>Layers</span>
        </div>
        <div class="menu-dropdown-item" data-action="show-guides">
            <i class="ph ph-check-square" data-window-icon="guides-window"></i>
            <span>Guides</span>
        </div>
        <div class="menu-dropdown-item" data-action="show-preview">
            <i class="ph ph-check-square" data-window-icon="preview-window"></i>
            <span>Preview</span>
        </div>
        <div class="menu-dropdown-item" data-action="show-canvas-controls">
            <i class="ph ph-check-square" data-window-icon="canvas-controls-window"></i>
            <span>Controls</span>
        </div>
    </div>

    <div class="menu-dropdown" id="menu-help">
        <div class="menu-dropdown-item" data-action="about">
            <i class="ph ph-info"></i>
            <span>About BitsDraw...</span>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-dropdown-item" data-action="shortcuts">
            <i class="ph ph-keyboard"></i>
            <span>Keyboard Shortcuts</span>
        </div>
    </div>

    <div class="desktop">
        <!-- Canvas Window -->
        <div class="window" id="canvas-window" style="left: 300px; top: 50px; width: 600px; height: 500px;">
            <div class="window-title-bar">
                <div class="window-controls">
                    <div class="window-control close"><i class="ph ph-x"></i></div>
                    <div class="window-control minimize"><i class="ph ph-minus"></i></div>
                    <div class="window-control zoom"><i class="ph ph-square"></i></div>
                </div>
                <div class="window-title">Canvas - my_bitmap (128x64)</div>
            </div>
            <div class="window-content">
                <div class="canvas-area">
                    <canvas id="bitmap-canvas"></canvas>
                </div>
            </div>
            <div class="window-resize-handle"></div>
        </div>

        <!-- Tools Window -->
        <div class="window small-titlebar" id="tools-window" style="left: 20px; top: 50px; width: 84px; min-width: 84px; max-width: 84px; resize: none;">
            <div class="window-title-bar">
                <div class="window-controls">
                    <div class="window-control close"><i class="ph ph-x"></i></div>
                    <div class="window-control minimize"><i class="ph ph-minus"></i></div>
                </div>
                <div class="window-title">Tools</div>
            </div>
            <div class="window-content">
                <div class="tool-palette">
                    <div class="tool-row">
                        <button id="brush-tool" class="tool-icon active" title="Brush"><i class="ph ph-paint-brush"></i></button>
                        <button id="pencil-tool" class="tool-icon" title="Pencil"><i class="ph ph-pencil"></i></button>
                    </div>
                    <div class="tool-row">
                        <button id="bucket-tool" class="tool-icon" title="Bucket Fill"><i class="ph ph-paint-bucket"></i></button>
                        <button id="eraser-tool" class="tool-icon" title="Eraser"><i class="ph ph-eraser"></i></button>
                    </div>
                    <div class="tool-row">
                        <button id="select-rect-tool" class="tool-icon" title="Rectangle Select"><i class="ph ph-selection"></i></button>
                        <button id="select-circle-tool" class="tool-icon" title="Circle Select"><i class="ph ph-circle-dashed"></i></button>
                    </div>
                    <div class="tool-row">
                        <button id="move-tool" class="tool-icon" title="Move"><i class="ph ph-arrows-out-cardinal"></i></button>
                        <button id="line-tool" class="tool-icon" title="Line"><i class="ph ph-line-segment"></i></button>
                    </div>
                    <div class="tool-row">
                        <button id="text-tool" class="tool-icon" title="Text"><i class="ph ph-text-aa"></i></button>
                        <button id="rect-tool" class="tool-icon" title="Rectangle"><i class="ph ph-rectangle"></i></button>
                    </div>
                    <div class="tool-row">
                        <button id="circle-tool" class="tool-icon" title="Circle"><i class="ph ph-circle"></i></button>
                        <button id="spray-tool" class="tool-icon" title="Spray"><i class="ph ph-spray-bottle"></i></button>
                    </div>
                    <div class="tool-row">
                        <button id="blur-tool" class="tool-icon" title="Blur"><i class="ph ph-drop-simple"></i></button>
                        <button id="guide-tool" class="tool-icon" title="Guide"><i class="ph ph-bounding-box"></i></button>
                    </div>
                    <div class="tool-row">
                        <button id="hand-tool" class="tool-icon" title="Hand"><i class="ph ph-hand"></i></button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Patterns Window -->
        <div class="window small-titlebar" id="colors-window" style="left: 20px; top: 250px; width: 84px; min-width: 84px; max-width: 84px; resize: none;">
            <div class="window-title-bar">
                <div class="window-controls">
                    <div class="window-control close"><i class="ph ph-x"></i></div>
                    <div class="window-control minimize"><i class="ph ph-minus"></i></div>
                </div>
                <div class="window-title">Patterns</div>
            </div>
            <div class="window-content">
                <div class="color-palette">
                    <div class="pattern-row">
                        <div class="color-swatch selected" data-pattern="solid-black" style="background: #000000;" title="Solid Black"></div>
                        <div class="color-swatch" data-pattern="solid-white" style="background: #ffffff; border: 1px solid #808080;" title="Solid White"></div>
                    </div>
                    <div class="pattern-row">
                        <div class="color-swatch" data-pattern="checker-2x2" title="Checker 2x2"></div>
                        <div class="color-swatch" data-pattern="checker-4x4" title="Checker 4x4"></div>
                    </div>
                    <div class="pattern-row">
                        <div class="color-swatch" data-pattern="diagonal-fill-50" title="Diagonal 50%"></div>
                        <div class="color-swatch" data-pattern="horizontal-lines" title="Horizontal Lines"></div>
                    </div>
                    <div class="pattern-row">
                        <div class="color-swatch" data-pattern="vertical-lines" title="Vertical Lines"></div>
                        <div class="color-swatch" data-pattern="cross-hatch" title="Cross Hatch"></div>
                    </div>
                    <div class="pattern-row">
                        <div class="color-swatch" data-pattern="dots-sparse" title="Dots Sparse"></div>
                        <div class="color-swatch" data-pattern="diagonal-lines" title="Diagonal Lines"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Options Window -->
        <div class="window small-titlebar" id="options-window" style="left: 20px; top: 380px; width: 600px;">
            <div class="window-title-bar">
                <div class="window-controls">
                    <div class="window-control close"><i class="ph ph-x"></i></div>
                    <div class="window-control minimize"><i class="ph ph-minus"></i></div>
                </div>
                <div class="window-title">Tool Options</div>
            </div>
            <div class="window-content">
                <div class="tool-options" id="tool-options">
                    <!-- Brush options -->
                    <div class="option-section" id="brush-options" style="display: none;">
                        <label>Size: <input type="range" id="brush-size" min="1" max="10" value="2"> <span id="brush-size-value">2</span>px</label>
                        <label><input type="checkbox" id="smooth-drawing" checked> Smooth</label>
                    </div>
                    
                    <!-- Pencil options -->
                    <div class="option-section" id="pencil-options" style="display: none;">
                        <label><input type="checkbox" id="pencil-smooth" checked> Smooth</label>
                        <span class="option-label">Smooth drawing with curve interpolation</span>
                    </div>
                    
                    <!-- Eraser options -->
                    <div class="option-section" id="eraser-options" style="display: none;">
                        <label>Size: <input type="range" id="eraser-size" min="1" max="10" value="2"> <span id="eraser-size-value">2</span>px</label>
                        <label><input type="checkbox" id="eraser-smooth" checked> Smooth</label>
                        <span class="option-label">Sets alpha=0, draw=0 for transparency</span>
                    </div>
                    
                    <!-- Shape tools options -->
                    <div class="option-section" id="shape-options" style="display: none;">
                        <label><input type="checkbox" id="draw-border" checked> <i class="ph ph-square"></i> Border</label>
                        <label><input type="checkbox" id="draw-fill"> <i class="ph ph-square-fill"></i> Fill</label>
                    </div>
                    
                    <!-- Circle tool options -->
                    <div class="option-section" id="circle-options" style="display: none;">
                        <label><input type="checkbox" id="circle-draw-border" checked> <i class="ph ph-square"></i> Border</label>
                        <label><input type="checkbox" id="circle-draw-fill"> <i class="ph ph-square-fill"></i> Fill</label>
                        <div class="circle-help">
                            <span class="option-label">Hold Shift for perfect circle</span>
                            <span class="option-label">Hold Option for center mode</span>
                        </div>
                    </div>
                    
                    <!-- Circle select tool options -->
                    <div class="option-section" id="circle-select-options" style="display: none;">
                        <div class="circle-help">
                            <span class="option-label">Hold Shift for perfect circle</span>
                            <span class="option-label">Hold Option for center mode</span>
                        </div>
                    </div>
                    
                    <!-- Spray options -->
                    <div class="option-section" id="spray-options" style="display: none;">
                        <label>Size: <input type="range" id="spray-radius" min="2" max="15" value="8"> <span id="spray-radius-value">8</span>px</label>
                        <label>Density: <input type="range" id="spray-density" min="10" max="100" value="60"> <span id="spray-density-value">60</span>%</label>
                    </div>
                    
                    <!-- Blur options -->
                    <div class="option-section" id="blur-options" style="display: none;">
                        <label>Blur Size: <input type="range" id="blur-size" min="1" max="10" value="3"> <span id="blur-size-value">3</span>px</label>
                        <label>Dither Method: 
                            <select id="blur-dither-method">
                                <option value="FloydSteinberg">Floyd-Steinberg</option>
                                <option value="Burkes">Burkes</option>
                                <option value="Atkinson">Atkinson</option>
                                <option value="Bayer2x2">Bayer 2×2</option>
                                <option value="Bayer4x4" selected>Bayer 4×4</option>
                                <option value="Bayer8x8">Bayer 8×8</option>
                            </select>
                        </label>
                        <label><input type="checkbox" id="blur-alpha-channel" checked> Dither Alpha Channel</label>
                        <span class="option-label">Click and drag to apply blur effect</span>
                    </div>
                    
                    <!-- Selection options -->
                    <div class="option-section" id="selection-options" style="display: none;">
                        <button id="clear-selection-btn"><i class="ph ph-selection"></i> Clear Selection</button>
                        <button id="select-all-btn"><i class="ph ph-selection-all"></i> Select All</button>
                    </div>
                    
                    <!-- Text options -->
                    <div class="option-section" id="text-options" style="display: none;">
                        <span class="option-label">Click on canvas to add text</span>
                    </div>
                    
                    <!-- Move tool options -->
                    <div class="option-section" id="move-options" style="display: none;">
                        <label><input type="checkbox" id="move-loop" checked> <i class="ph ph-arrow-clockwise"></i> Loop</label>
                        <span class="option-label">Loop wraps pixels around edges</span>
                    </div>
                    
                    <!-- Guide tool options -->
                    <div class="option-section" id="guide-options" style="display: none;">
                        <label>Guide Name: <input type="text" id="guide-name" value="Guide" placeholder="Guide name"></label>
                        <label><input type="checkbox" id="guide-snap" checked> <i class="ph ph-magnet"></i> Snap to Grid</label>
                        <span class="option-label">Click and drag to create guides</span>
                    </div>
                    
                    <!-- Hand tool options -->
                    <div class="option-section" id="hand-options" style="display: none;">
                        <span class="option-label">Click and drag to pan the canvas</span>
                    </div>
                    
                    <!-- Bucket fill options -->
                    <div class="option-section" id="bucket-options" style="display: none;">
                        <label><input type="checkbox" id="fill-contiguous" checked> Contiguous</label>
                    </div>
                    
                    <!-- Project settings -->
                    <div class="option-section" id="project-options" style="display: block;">
                        <label>Project Name: <input type="text" id="project-name" value="my_bitmap" placeholder="my_bitmap"></label>
                    </div>
                    
                    <!-- No options for other tools -->
                    <div class="option-section" id="no-options" style="display: none;">
                        <span class="option-label">Select a tool to view options</span>
                    </div>
                </div>
            </div>
        </div>



        <!-- About BitsDraw Window -->
        <div class="window hidden" id="about-window" style="left: 400px; top: 200px; width: 450px; height: 350px;">
            <div class="window-title-bar">
                <div class="window-controls">
                    <div class="window-control close"><i class="ph ph-x"></i></div>
                </div>
                <div class="window-title">About BitsDraw</div>
            </div>
            <div class="window-content">
                <div class="about-content">
                    <div class="about-icon">
                        <img src="icons/BitsDraw.png" alt="BitsDraw" class="app-icon-image">
                    </div>
                    <div class="about-info">
                        <h2>BitsDraw</h2>
                        <p class="version">Version 1.0.2 (Beta)</p>
                        
                        <div class="about-section">
                            <h3>Copyright</h3>
                            <p>© 2024 kurogedelic. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Keyboard Shortcuts Window -->
        <div class="window hidden" id="shortcuts-window" style="left: 450px; top: 150px; width: 400px; height: 450px;">
            <div class="window-title-bar">
                <div class="window-controls">
                    <div class="window-control close"><i class="ph ph-x"></i></div>
                </div>
                <div class="window-title">Keyboard Shortcuts</div>
            </div>
            <div class="window-content">
                <div class="shortcuts-content">
                    <div class="shortcuts-section">
                        <h3>File Operations</h3>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃N</span>
                            <span class="shortcut-desc">New Canvas</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃S</span>
                            <span class="shortcut-desc">Save</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃O</span>
                            <span class="shortcut-desc">Open</span>
                        </div>
                    </div>
                    
                    <div class="shortcuts-section">
                        <h3>Edit Operations</h3>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃Z</span>
                            <span class="shortcut-desc">Undo</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃Y</span>
                            <span class="shortcut-desc">Redo</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃A</span>
                            <span class="shortcut-desc">Select All</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃C</span>
                            <span class="shortcut-desc">Copy Selection</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃X</span>
                            <span class="shortcut-desc">Cut Selection</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃V</span>
                            <span class="shortcut-desc">Paste Selection</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">Delete</span>
                            <span class="shortcut-desc">Delete Selection</span>
                        </div>
                    </div>
                    
                    <div class="shortcuts-section">
                        <h3>Tools</h3>
                        <div class="shortcut-item">
                            <span class="shortcut-key">P</span>
                            <span class="shortcut-desc">Pencil Tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">B</span>
                            <span class="shortcut-desc">Brush Tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">F</span>
                            <span class="shortcut-desc">Bucket Fill</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">E</span>
                            <span class="shortcut-desc">Eraser Tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">L</span>
                            <span class="shortcut-desc">Line Tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">T</span>
                            <span class="shortcut-desc">Text Tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">R</span>
                            <span class="shortcut-desc">Rectangle Tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">C</span>
                            <span class="shortcut-desc">Circle Tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">S</span>
                            <span class="shortcut-desc">Spray Tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">I</span>
                            <span class="shortcut-desc">Eyedropper Tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">M</span>
                            <span class="shortcut-desc">Select Tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">V</span>
                            <span class="shortcut-desc">Move Tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">H</span>
                            <span class="shortcut-desc">Hand Tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">U</span>
                            <span class="shortcut-desc">Guide Tool</span>
                        </div>
                    </div>
                    
                    <div class="shortcuts-section">
                        <h3>View</h3>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃=</span>
                            <span class="shortcut-desc">Zoom In</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃-</span>
                            <span class="shortcut-desc">Zoom Out</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">⌃G</span>
                            <span class="shortcut-desc">Toggle Grid</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Layers Window -->
        <div class="window small-titlebar" id="layers-window" style="left: 240px; top: 250px; width: 220px; max-height: 400px;">
            <div class="window-title-bar">
                <div class="window-controls">
                    <div class="window-control close"><i class="ph ph-x"></i></div>
                    <div class="window-control minimize"><i class="ph ph-minus"></i></div>
                </div>
                <div class="window-title">Layers</div>
            </div>
            <div class="window-content">
                <div class="layer-controls">
                    <button id="add-layer-btn" title="Add Layer"><i class="ph ph-plus"></i></button>
                    <button id="delete-layer-btn" title="Delete Layer"><i class="ph ph-trash"></i></button>
                    <button id="duplicate-layer-btn" title="Duplicate Layer"><i class="ph ph-copy"></i></button>
                </div>
                <div class="layer-list" id="layer-list">
                    <!-- Layers will be dynamically added here -->
                </div>
            </div>
        </div>

        <!-- Preview Window -->
        <div class="window small-titlebar" id="preview-window" style="left: 20px; top: 420px; width: 180px;">
            <div class="window-title-bar">
                <div class="window-controls">
                    <div class="window-control close"><i class="ph ph-x"></i></div>
                    <div class="window-control minimize"><i class="ph ph-minus"></i></div>
                </div>
                <div class="window-title">Preview (1:1)</div>
            </div>
            <div class="window-content">
                <div class="preview-area">
                    <canvas id="preview-canvas"></canvas>
                </div>
            </div>
        </div>

        <!-- Guides Window -->
        <div class="window small-titlebar" id="guides-window" style="left: 470px; top: 250px; width: 320px; max-height: 400px;">
            <div class="window-title-bar">
                <div class="window-controls">
                    <div class="window-control close"><i class="ph ph-x"></i></div>
                    <div class="window-control minimize"><i class="ph ph-minus"></i></div>
                </div>
                <div class="window-title">Guides</div>
            </div>
            <div class="window-content">
                <div class="guides-controls">
                    <button id="add-guide-btn" title="Add Guide"><i class="ph ph-plus"></i></button>
                    <button id="export-guides-btn" title="Export Guides"><i class="ph ph-download"></i></button>
                    <button id="clear-guides-btn" title="Clear All"><i class="ph ph-trash"></i></button>
                </div>
                <div class="guides-list" id="guides-list">
                    <!-- Guides will be dynamically added here -->
                </div>
            </div>
        </div>

        <!-- Canvas Controls Window -->
        <div class="window small-titlebar" id="canvas-controls-window" style="left: 300px; top: 570px; width: 84px; min-width: 84px; max-width: 84px; resize: none; height: auto;">
            <div class="window-title-bar">
                <div class="window-controls">
                    <div class="window-control close"><i class="ph ph-x"></i></div>
                    <div class="window-control minimize"><i class="ph ph-minus"></i></div>
                </div>
                <div class="window-title">Controls</div>
            </div>
            <div class="window-content">
                <div class="canvas-controls-vertical">
                    <!-- Zoom Level -->
                    <div class="control-block">
                        <button class="dropdown-button" id="zoom-dropdown-btn" title="Zoom Level">
                            <span id="zoom-current-value">4x</span>
                            <i class="ph ph-caret-down"></i>
                        </button>
                        <select id="zoom-select" style="display: none;">
                            <option value="1">1x</option>
                            <option value="2">2x</option>
                            <option value="4" selected>4x</option>
                            <option value="8">8x</option>
                            <option value="16">16x</option>
                            <option value="32">32x</option>
                        </select>
                    </div>
                    
                    <!-- Zoom Buttons -->
                    <div class="control-block">
                        <div class="zoom-buttons">
                            <button id="zoom-out-btn" title="Zoom Out"><i class="ph ph-magnifying-glass-minus"></i></button>
                            <button id="zoom-in-btn" title="Zoom In"><i class="ph ph-magnifying-glass-plus"></i></button>
                        </div>
                    </div>
                    
                    <!-- Display Mode -->
                    <div class="control-block">
                        <button class="dropdown-button" id="display-dropdown-btn" title="Display Mode">
                            <div class="display-preview" id="display-preview-icon"></div>
                            <i class="ph ph-caret-down"></i>
                        </button>
                        <select id="display-mode-select" style="display: none;">
                            <option value="black">Black</option>
                            <option value="white" selected>White</option>
                            <option value="lcd-classic">LCD Classic</option>
                            <option value="lcd-inverted">LCD Inverted</option>
                            <option value="night-blue">Night Blue</option>
                            <option value="night-green">Night Green</option>
                            <option value="amber">Amber</option>
                            <option value="terminal">Terminal</option>
                            <option value="blue">Blue</option>
                            <option value="paper-white">Paper White</option>
                            <option value="e-ink-gray">E-Ink Gray</option>
                            <option value="playdate">Playdate</option>
                        </select>
                    </div>
                    
                    <!-- Grid and Checkerboard -->
                    <div class="control-block">
                        <div class="grid-buttons">
                            <button id="show-grid-btn" title="Show Grid"><i class="ph ph-grid-four"></i></button>
                            <button id="show-checkerboard-btn" title="Show Checkerboard"><i class="ph ph-checkerboard"></i></button>
                        </div>
                    </div>
                    
                    <!-- Guides -->
                    <div class="control-block">
                        <div class="grid-buttons">
                            <button id="show-guides-btn" title="Show Guides"><i class="ph ph-bounding-box"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>

    <!-- New Canvas Dialog -->
    <div class="dialog-overlay" id="new-canvas-dialog" style="display: none;">
        <div class="dialog">
            <div class="dialog-header">
                <h3>New Canvas</h3>
                <button class="dialog-close" id="new-canvas-close-btn"><i class="ph ph-x"></i></button>
            </div>
            <div class="dialog-content">
                <div class="preset-section">
                    <h4>Preset</h4>
                    <select id="preset-select">
                        <option value="">Custom Size</option>
                        <option value="128,64" selected>OLED 128×64</option>
                        <option value="128,32">OLED 128×32</option>
                        <option value="72,40">OLED 72×40</option>
                        <option value="400,240">Playdate 400×240</option>
                        <option value="512,342">Classic Mac 512×342</option>
                        <option value="640,480">VGA 640×480</option>
                        <option value="720,350">MDA 720×350</option>
                        <option value="800,600">SVGA 800×600</option>
                        <option value="1024,768">XGA 1024×768</option>
                        <option value="160,144">Game Boy 160×144</option>
                        <option value="576,720">Mac Paint 576×720</option>
                    </select>
                </div>
                <div class="custom-section">
                    <h4>Size</h4>
                    <div class="size-inputs">
                        <label>
                            Width: <input type="number" id="canvas-width" min="1" max="2048" value="128">
                        </label>
                        <label>
                            Height: <input type="number" id="canvas-height" min="1" max="2048" value="64">
                        </label>
                        <button id="swap-dimensions-btn" type="button" title="Swap Width/Height">
                            <i class="ph ph-arrow-bend-up-right"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="dialog-footer">
                <button class="dialog-btn dialog-btn-cancel" id="new-canvas-cancel-btn">Cancel</button>
                <button class="dialog-btn dialog-btn-primary" id="new-canvas-create-btn">Create</button>
            </div>
        </div>
    </div>

    <!-- Text Input Balloon -->
    <div class="text-balloon" id="text-balloon" style="display: none;">
        <div class="balloon-content">
            <input type="text" id="text-input-balloon" placeholder="Enter text..." maxlength="50">
            <div class="balloon-buttons">
                <button id="add-text-balloon-btn"><i class="ph ph-check"></i></button>
                <button id="cancel-text-balloon-btn"><i class="ph ph-x"></i></button>
            </div>
        </div>
    </div>

    <!-- Brush Cursor Overlay -->
    <div class="brush-cursor-overlay" id="brush-cursor-overlay"></div>

    <!-- Hidden file input for image import -->
    <input type="file" id="file-input" accept="image/*" style="position: absolute; left: -9999px; top: -9999px; opacity: 0; width: 1px; height: 1px; z-index: -1;">

    <!-- CPP Export Dialog -->
    <div class="dialog-overlay" id="cpp-export-dialog" style="display: none;">
        <div class="dialog">
            <div class="dialog-header">
                <h3>Export CPP Header File</h3>
                <button class="dialog-close" id="cpp-export-close-btn"><i class="ph ph-x"></i></button>
            </div>
            <div class="dialog-content">
                <div class="input-section">
                    <label for="export-format-select">Format:</label>
                    <select id="export-format-select">
                        <option value="u8g2">U8G2 (XBM, LSB first)</option>
                        <option value="adafruit">Adafruit GFX (MSB first)</option>
                        <option value="playdate">Playdate PDI</option>
                        <option value="gameboy">Game Boy 2BPP</option>
                    </select>
                </div>
                <div class="input-section">
                    <label for="array-name-input">Array Name:</label>
                    <input type="text" id="array-name-input" value="my_bitmap" placeholder="my_bitmap">
                </div>
                <div class="code-section">
                    <label for="cpp-export-code">Generated Code:</label>
                    <textarea id="cpp-export-code" readonly rows="15"></textarea>
                </div>
            </div>
            <div class="dialog-footer">
                <button class="dialog-btn dialog-btn-cancel" id="cpp-export-cancel-btn">Cancel</button>
                <button class="dialog-btn dialog-btn-primary" id="cpp-export-copy-btn">Copy .h Code</button>
            </div>
        </div>
    </div>

    <!-- CPP Import Dialog -->
    <div class="dialog-overlay" id="cpp-import-dialog" style="display: none;">
        <div class="dialog">
            <div class="dialog-header">
                <h3>Import CPP Header File</h3>
                <button class="dialog-close" id="cpp-import-close-btn"><i class="ph ph-x"></i></button>
            </div>
            <div class="dialog-content">
                <div class="import-section">
                    <label for="cpp-import-file">Select .h file:</label>
                    <input type="file" id="cpp-import-file" accept=".h,.txt">
                    <p class="help-text">Or paste code below:</p>
                    <textarea id="cpp-import-code" placeholder="Paste .h code here..." rows="10"></textarea>
                </div>
            </div>
            <div class="dialog-footer">
                <button class="dialog-btn dialog-btn-cancel" id="cpp-import-cancel-btn">Cancel</button>
                <button class="dialog-btn dialog-btn-primary" id="cpp-import-load-btn">Import</button>
            </div>
        </div>
    </div>

    <!-- Image Placement Dialog -->
    <div class="dialog-overlay" id="image-placement-dialog" style="display: none;">
        <div class="dialog image-placement-dialog">
            <div class="dialog-header">
                <h3>Place Image</h3>
                <button class="dialog-close" id="image-placement-close-btn"><i class="ph ph-x"></i></button>
            </div>
            <div class="dialog-content">
                <div class="image-placement-content">
                    <div class="placement-preview">
                        <div class="preview-container">
                            <canvas id="placement-preview-canvas" class="placement-canvas"></canvas>
                            <div class="resize-handles" id="resize-handles" style="display: none;">
                                <div class="resize-handle nw" data-direction="nw"></div>
                                <div class="resize-handle ne" data-direction="ne"></div>
                                <div class="resize-handle sw" data-direction="sw"></div>
                                <div class="resize-handle se" data-direction="se"></div>
                                <div class="resize-handle n" data-direction="n"></div>
                                <div class="resize-handle s" data-direction="s"></div>
                                <div class="resize-handle w" data-direction="w"></div>
                                <div class="resize-handle e" data-direction="e"></div>
                            </div>
                        </div>
                    </div>
                    <div class="placement-controls">
                        <div class="control-group">
                            <label>Size Options:</label>
                            <div class="size-buttons">
                                <button class="dialog-btn" id="original-size-btn">100% Original Size</button>
                                <button class="dialog-btn" id="fit-canvas-btn">Stretch to Fit Canvas</button>
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Image Information:</label>
                            <div class="image-info">
                                <span id="original-dimensions">Original: -</span>
                                <span id="current-dimensions">Current: -</span>
                                <span id="canvas-dimensions">Canvas: -</span>
                            </div>
                        </div>
                        <div class="threshold-control">
                            <label>Threshold: <span id="threshold-value">128</span></label>
                            <div class="threshold-slider-container">
                                <input type="range" id="threshold-slider" min="0" max="255" value="128">
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Transparency Handling:</label>
                            <select id="alpha-handling-select">
                                <option value="blend">Blend with White</option>
                                <option value="transparent-white">Transparent → White</option>
                                <option value="transparent-black">Transparent → Black</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Conversion Method:</label>
                            <select id="dither-method-select">
                                <option value="threshold">Simple Threshold</option>
                                <option value="floyd-steinberg">Floyd-Steinberg Dithering</option>
                                <option value="atkinson">Atkinson Dithering</option>
                                <option value="burkes">Burkes Dithering</option>
                                <option value="bayer-2x2">Bayer 2×2 Dithering</option>
                                <option value="bayer-4x4">Bayer 4×4 Dithering</option>
                                <option value="bayer-8x8">Bayer 8×8 Dithering</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Color Processing:</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" id="invert-colors-checkbox"> Invert Colors</label>
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Alpha Channel Mode:</label>
                            <select id="alpha-mode-select">
                                <option value="ignore">Ignore Alpha (Opaque)</option>
                                <option value="preserve">Preserve Original Alpha</option>
                                <option value="white-to-alpha">White → Transparent</option>
                                <option value="black-to-alpha">Black → Transparent</option>
                                <option value="no-alpha">Force Opaque</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="dialog-footer">
                <button class="dialog-btn dialog-btn-cancel" id="image-placement-cancel-btn">Cancel</button>
                <button class="dialog-btn dialog-btn-primary" id="image-placement-apply-btn">Apply</button>
            </div>
        </div>
    </div>

    <!-- Dithering Dialog -->
    <div class="dialog-overlay" id="dithering-dialog" style="display: none;">
        <div class="dialog dithering-dialog-vertical">
            <div class="dialog-header">
                <h3>Dithering</h3>
                <button class="dialog-close" id="dithering-close-btn"><i class="ph ph-x"></i></button>
            </div>
            <div class="dialog-content">
                <div class="dithering-content-vertical">
                    <!-- Top half: Before/After preview -->
                    <div class="dithering-preview-area">
                        <div class="preview-comparison-horizontal">
                            <div class="preview-section">
                                <label>Before</label>
                                <canvas id="dithering-original-canvas"></canvas>
                            </div>
                            <div class="preview-section">
                                <label>After</label>
                                <canvas id="dithering-preview-canvas"></canvas>
                            </div>
                        </div>
                    </div>
                    <!-- Bottom half: Controls -->
                    <div class="dithering-controls-area">
                        <div class="dithering-controls-grid">
                            <div class="control-group">
                                <label>Method:</label>
                                <select id="dithering-method">
                                    <option value="Bayer2x2">Bayer 2×2</option>
                                    <option value="Bayer4x4" selected>Bayer 4×4</option>
                                    <option value="Bayer8x8">Bayer 8×8</option>
                                    <option value="FloydSteinberg">Floyd-Steinberg</option>
                                    <option value="Burkes">Burkes</option>
                                    <option value="Atkinson">Atkinson</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label>Alpha: <span id="dithering-alpha-value">1.0</span></label>
                                <input type="range" id="dithering-alpha" min="0" max="100" value="100" step="1">
                            </div>
                            <div class="control-group">
                                <label><input type="checkbox" id="dithering-alpha-channel"> Dither Alpha Channel</label>
                                <span class="dithering-info-small">Apply dithering to transparency</span>
                            </div>
                            <div class="control-group">
                                <div class="dithering-info">
                                    <span>Level controls the dithering intensity</span>
                                    <span>Higher values = more dithering</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="dialog-footer">
                <button class="dialog-btn dialog-btn-cancel" id="dithering-cancel-btn">Cancel</button>
                <button class="dialog-btn dialog-btn-primary" id="dithering-apply-btn">Apply</button>
            </div>
        </div>
    </div>

    
    <!-- Core utilities -->
    <script src="utils/optimizedBitmap.js"></script>
    <script src="utils/export.js"></script>
    <script src="utils/imageImport.js"></script>
    <script src="utils/patterns.js"></script>
    <script src="utils/textRenderer.js"></script>
    <script src="utils/pngIconLoader.js"></script>
    <script src="utils/ditheringEffects.js"></script>
    
    <!-- Refactored managers -->
    <script src="utils/dialogManager.js"></script>
    <script src="utils/menuManager.js"></script>
    <script src="utils/windowManager.js"></script>
    <script src="utils/toolManager.js"></script>
    <script src="utils/imagePlacementDialog.js"></script>
    
    <!-- New Refactored Architecture -->
    <script src="src/core/EventBus.js"></script>
    <script src="src/core/StateManager.js"></script>
    <script src="src/core/CommandSystem.js"></script>
    <script src="src/tools/ToolSystem.js"></script>
    
    <!-- CanvasUnit System (Phase 1) -->
    <script src="src/core/CanvasUnit.js"></script>
    <script src="src/core/CanvasUnitManager.js"></script>
    <script src="src/core/LegacyAdapter.js"></script>
    
    <!-- Advanced Tools (Phase 4) -->
    <script src="src/tools/SmartCopyTool.js"></script>
    <script src="src/tools/ConversionManager.js"></script>
    <script src="src/ui/ConversionDialog.js"></script>
    
    <!-- Animation Export (Phase 5) -->
    <script src="src/export/AnimationExporter.js"></script>
    <script src="src/ui/AnimationExportDialog.js"></script>
    
    <!-- Project Management (Phase 6) -->
    <script src="src/core/ProjectManager.js"></script>
    <script src="src/ui/ProjectDialog.js"></script>
    
    <script src="src/core/Application.js"></script>
    <script src="src/RefactorBridge.js"></script>
    <script src="src/RefactorMonitor.js"></script>
    
    <!-- Main application -->
    <script src="main.js"></script>
    
    <!-- Vite ES Module entry point for development features -->
    <script type="module" src="/src/main.js"></script>
</body>
</html>
